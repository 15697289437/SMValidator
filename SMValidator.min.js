/*!
 * SMValidator.js 0.5.0
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 */!function(e,l){"object"==typeof exports&&"undefined"!=typeof module?module.exports=l():"function"==typeof define&&define.amd?define(l):e.SMValidator=l()}(this,function(){"use strict";function e(e,l){if(e){l||(l={}),this.blur=l.blur,this.manul=l.manul,this.submit=l.submit,this.rules=l.rules||{},this.failHtml=l.failHtml||f.failHtml,this.failStyle=l.failStyle||f.failStyle,this.failClass=l.failClass||f.failClass,this.fields={};for(var t in l.fields)this.fields[t]=this.parseRule(l.fields[t]);this.inputs=this.queryInput(e)}}function l(e,l,t){var r=e.className.split(" "),i=r.indexOf(l);t&&i>-1?(r.splice(i,1),e.className=r.join(" ")):t||i!==-1||(e.className+=e.className?" "+l:l)}function t(e,l,t){for(var r=l.length-1;r>=0;r--)l[r].style.display=t?"none":""}function r(e,l){for(var t in l)e.style[t]=l[t]}function i(e){if("text"===e.type){var i=e._SMRule_,a=!0;if(i.required||""!==e.value)for(var n=i.rules.length-1;n>=0;n--){var s=i.rules[n];if(s.rule instanceof RegExp){if(!s.rule.test(e.value)){a=s.message;break}}else{if(s.params){var u=[e.value].concat(s.params);a=s.rule.apply(null,u)}else a=s.rule.call(null,e.value);if(a!==!0)break}}return a===!0?(i.failClass&&l(e,i.failClass,!0),i.failStyle&&r(e,e._SMStyle_),i.failSelector?t(e,i.failSelector,!0):e._failHtml_.style.display="none"):(i.failClass&&l(e,i.failClass,!1),i.failStyle&&r(e,i.failStyle),i.failSelector?t(e,i.failSelector,!1):(e._failHtml_.innerText=a,e._failHtml_.style.display="")),a}}var a=window.document,n=a.addEventListener?a.addEventListener:a.attachEvent,s="oninput"in a?"input":"propertychange";n.call(a,s,function(e){var l=e.target;!l._SMRule_||l._SMRule_.manul||l._SMRule_.blur||i(l)}),n.call(a,"change",function(e){var l=e.target;l._SMRule_&&!l._SMRule_.manul&&l._SMRule_.blur&&i(l)});var u=e.prototype;u.queryInput=function(l,t){for(var r=this,i=[],s=a.querySelectorAll(l),u=s.length-1;u>=0;u--){var f=s[u];if("FORM"===f.tagName){f.novalidate="novalidate";for(var o=[],c=f.length-1;c>=0;c--)r.bindInput(f[c],t)&&o.push(f[c]);i=i.concat(o),r.submit&&o.length&&(f._SMInputs_=o,n.call(f,"submit",function(l){l.preventDefault();var t=e.validate(l.target._SMInputs_,!0);r.submit(t,l.target)}))}else"INPUT"===f.tagName&&r.bindInput(f,t)&&i.push(f)}return i},u.bindInput=function(e,l){if(e._SMRule_&&!l)return!0;var t=e.getAttribute("name"),r=e.getAttribute("data-rule"),i=r?this.parseString(r):this.fields[t];if(i){if(e._SMRule_=i,i.failStyle!==!0){i.failStyle||i._isInit||(i.failStyle=this.failStyle||f.failStyle),e._SMStyle_={};for(var n in i.failStyle)e._SMStyle_[n]=e.style[n]}if(!i._isInit){if(i._isInit=!0,i.blur||(i.blur=this.blur),i.manul||(i.manul=this.manul),i.failSelector){var s=a.querySelectorAll(i.failSelector);if(s.length){i.failSelector=s;for(var u=s.length-1;u>=0;u--)s[u].style.display="none";return!0}i.failSelector=null}i._useFailHtml=!0,i.failHtml||(i.failHtml=this.failHtml||f.failHtml)}if(i._useFailHtml){var o=a.createElement("div");o.innerHTML=i.failHtml,e._failHtml_=o.childNodes[0],e.parentNode.insertBefore(e._failHtml_,e.nextElementSibling)}return!0}return!1},u.parseFunctionOrArray=function(e){var l={},t=e.indexOf("(");if(t>0){var r=e.indexOf(")");l.params=e.substring(t+1,r).split(","),e=e.substring(0,t)}var i=this.rules[e]||f.rules[e];return i instanceof Array?(l.rule=i[0],l.message=i[1]):l.rule=i,l},u.parseString=function(e){for(var l={rules:[]},t=e.split(";"),r=t.length-1;r>=0;r--){var i=t[r];if(""!==i){var a=i.charAt(0),n=i.substring(1);if("/"===a){var s=n.split("/");2===s.length?l.rules.push({rule:new RegExp(s[0]),message:s[1]}):3===s.length&&l.rules.push({rule:new RegExp(s[0],"i"),message:s[2]})}else"#"===a?l.failSelector=n:"!"===a?l.failClass=n:"@"===a?l[n]=!0:(l.rules.push(this.parseFunctionOrArray(i)),l.required="required"===i)}}return l},u.parseRule=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if("string"==typeof e)return this.parseString(e);if("object"==typeof e){if(e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if("string"==typeof e.rule){var l=e.rule.split(";");e.rules=[];for(var t=l.length-1;t>=0;t--)e.rules.push(this.parseFunctionOrArray(l[t]))}return delete e.rule,e}},u.validate=function(l,t){return e.validate(this.inputs,l,t)};var f={failHtml:'<span style="color:#c00;"></span>',failStyle:{color:"#c00",border:"1px solid #c00"},rules:{required:function(e){return""!==e||"这是必填项"},range:function(e,l,t){var r=e.length;return 2===arguments.length?l>=0?r>l||"长度必须大于"+l:r<-l||"长度必须小于"+-l:3===arguments.length?r>l&&r<t||"长度必须大于 "+l+" 且小于 "+t:void 0}}};e.config=function(e){if(e.failStyle&&(f.failStyle=e.failStyle),e.failHtml&&(f.failHtml=e.failHtml),e.rules)for(var l in e.rules)f.rules[l]=parseRule(e.rules[l])};var o=new e;return o.rules=o.fields={},e.validate=function(e,l,t){for(var r="string"==typeof e?o.queryInput(e,t):e,a=r.length,n=0,s=0;s<a;s++){var u=r[s];(u._SMRule_.manul||l)&&i(u)===!0&&n++}return n===a},e});