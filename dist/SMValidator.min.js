/*!
 * SMValidator.js 0.6.0
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 */!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.SMValidator=t()}(this,function(){"use strict";function e(e,t){if(e){var r=this;t||(t={});for(var s=u.length-1;s>=0;s--){var n=u[s];r[n]=t[n]||o[n]}r.rules=t.rules||{},r.submit=t.submit,r.fields={};for(var l in t.fields)r.fields[l]=r.parseField(t.fields[l]);r.inputs=r.queryInput(e)}}function t(e,t,r){if(t){var s=e.className.split(" "),n=s.indexOf(t);!r&&n>-1?(s.splice(n,1),e.className=s.join(" ")):r&&n===-1&&(e.className+=e.className?" "+t:t)}}function r(e,t){e&&(e.style.display=t?"":"none")}function s(e,t){if(t)for(var r in t)e.style[r]=t[r]}function n(e){if("text"===e.type){var n=e._sm,l=n.rule,a=!0,i=1;if(l.required||""!==e.value)for(var u=l.rules.length-1;u>=0;u--){var f=l.rules[u],o=f.rule;if(o instanceof RegExp){if(!o.test(e.value)){a=f.message,i=2;break}}else if(a=f.params?o.apply(null,[e.value].concat(f.params)):o.call(null,e.value),a!==!0){i=2;break}}else i=0;return i!==n.flag&&(n.flag=i,s(e,n.style),r(n.failHtml,!1),r(n.passHtml,!1),0===i?(t(e,l.failCss,!1),t(e,l.passCss,!1)):1===i?(t(e,l.failCss,!1),t(e,l.passCss,!0),s(e,l.passStyle),r(n.passHtml,!0),l.pass&&l.pass.call(e)):(t(e,l.passCss,!1),t(e,l.failCss,!0),s(e,l.failStyle),r(n.failHtml,!0),n.failHtml&&(n.failHtml.innerText=a),l.fail&&l.fail.call(e))),a}}var l=window.document,a=l.addEventListener?l.addEventListener:l.attachEvent,i="oninput"in l?"input":"propertychange";a.call(l,i,function(e){var t=e.target;!t._sm||t._sm.rule.manul||t._sm.rule.blur||n(t)}),a.call(l,"change",function(e){var t=e.target;t._sm&&!t._sm.rule.manul&&t._sm.rule.blur&&n(t)});var u=["blur","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],f=e.prototype;f.queryInput=function(t){for(var r=this,s=[],n=l.querySelectorAll(t),i=n.length-1;i>=0;i--){var u=n[i];if("FORM"===u.tagName){u.novalidate="novalidate";for(var f=[],o=u.length-1;o>=0;o--)r.bindInput(u[o])&&f.push(u[o]);s=s.concat(f),r.submit&&f.length&&(u._SMInputs_=f,a.call(u,"submit",function(t){t.preventDefault();var s=e.validate(t.target._SMInputs_,!0);r.submit(s,t.target)}))}else"INPUT"===u.tagName&&r.bindInput(u)&&s.push(u)}return s},f.bindInput=function(e){function t(e,t){if("string"==typeof e[t])try{e[t]=JSON.parse(e[t].replace(/'/g,'"'))}catch(r){console.error("error json format: "+e[t])}}function r(e,t){if(t){e._sm.style||(e._sm.style={});var r=e._sm.style;for(var s in t)r[s]||(r[s]=e.style[s])}}function s(e,t,r){var s;if(0===r.indexOf("<")){var n=l.createElement("div");n.innerHTML=i.failHtml,s=n.childNodes[0],e.parentNode.insertBefore(s,e.nextElementSibling)}else s=l.querySelector(r);s&&(s.style.display="none",e._sm[t]=s)}if(e._sm)return!0;var n=e.getAttribute("name"),a=e.getAttribute("data-rule"),i=a?this.parseString(a):this.fields[n];if(i){if(e._sm={rule:i,flag:0},!i._isInit){i._isInit=!0;for(var f=u.length-1;f>=0;f--){var o=u[f];i[o]||(i[o]=this[o])}t(i,"failStyle"),t(i,"passStyle")}return r(e,i.failStyle),r(e,i.passStyle),i.failHtml&&s(e,"failHtml",i.failHtml),i.passHtml&&s(e,"passHtml",i.passHtml),!0}return!1},f.parseRule=function(e,t){var r=e.name,s=this.rules[r]||o.rules[r];s&&(s instanceof Array?t.rules.push({rule:s[0],message:s[1]}):t.rules.push({rule:s,params:e.params}),t.required="required"===r)},f.parseStringFunction=function(e){var t={name:e},r=e.indexOf("(");return r>0&&(t.name=e.substring(0,r),t.params=e.substring(r+1,e.length-1).split(",")),t},f.parseString=function(e){for(var t={rules:[]},r=e.split(";"),s=r.length-1;s>=0;s--){var n=r[s];if(""!==n)if(0===n.indexOf("/")){var l=n.substring(1).split("/");2===l.length?t.rules.push({rule:new RegExp(l[0]),message:l[1]}):3===l.length&&t.rules.push({rule:new RegExp(l[0],"i"),message:l[2]})}else{var a=this.parseStringFunction(n);if(u.indexOf(a.name)>-1){var i=a.name;"blur"===i||"manul"===i?t[i]=!0:t[i]=a.params[0]}else this.parseRule(a,t)}}return t},f.parseField=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if("string"==typeof e)return this.parseString(e);if("object"==typeof e){if(e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if("string"==typeof e.rule){var t=e.rule.split(";");e.rules=[];for(var r=t.length-1;r>=0;r--)""!==t[r]&&this.parseRule(this.parseStringFunction(t[r]),e);delete e.rule}return e}},f.validate=function(t){return e.validate(this.inputs,t)};var o={rules:{required:function(e){return""!==e||"this is required"}}};e.config=function(e){for(var t=u.length-1;t>=0;t--){var r=u[t];e[r]&&(o[r]=e[r])}if(e.rules)for(var s in e.rules)o.rules[s]=e.rules[s]};var p=new e;return p.rules=p.fields={},e.validate=function(e,t){for(var r="string"==typeof e?p.queryInput(e):e,s=0,l=0,a=r.length-1;a>=0;a--){var i=r[a];i._sm&&(l++,(i._sm.rule.manul||t)&&n(i)===!0&&s++)}return l===s},e.config({failHtml:'<span style="color:#c00;"></span>',failStyle:{color:"#c00",border:"1px solid #c00"},rules:{required:function(e){return""!==e||"这是必填字段"},range:function(e,t,r){var s=/^-?\d+$/;return s.test(e)?""===t||s.test(t)||""===r||s.test(r)?2===arguments.length?e==t||"值必须等于"+t:3===arguments.length?t&&r?e>t&&e<r||"值必须大于 "+t+" 且小于 "+r:t?e>t||"值必须大于 "+t:r?e<r||"值必须小于 "+r:"无效参数":void 0:"无效参数":"不是数字"},length:function(e,t,r){var s=e.length;return 2===arguments.length?s==t||"长度必须等于"+t:3===arguments.length?t&&r?s>t&&s<r||"长度必须大于 "+t+" 且小于 "+r:t?s>t||"长度必须大于 "+t:r?s<r||"长度必须小于 "+r:"无效参数":void 0}}}),e});