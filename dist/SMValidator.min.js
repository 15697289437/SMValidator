/*!
 * sm-validator 0.14.1
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 * Released under the MIT License.
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e){return"string"==typeof e}function r(e,r){return c.call(e,r)}function s(e,s){var t=this;s||(s={});for(var a=p.length-1;a>=0;a--){var l=p[a];t[l]=r(s,l)?s[l]:v[l]}if(t.fields={},t.rules=s.rules||{},e){t.submit=s.submit;for(var n in s.fields)t.fields[n]=t.parseField(s.fields[n]);t.queryInput(e)}}function t(e,r){if(e)for(var s=e.length-1;s>=0;s--){for(var t=e[s],a=t.target,l=t.className.split(" "),n=a.className.split(" "),i=l.length-1;i>=0;i--){var u=l[i],o=n.indexOf(u);!r&&o>-1?n.splice(o,1):r&&o===-1&&n.push(u)}a.className=n.join(" ")}}function a(e,r,s){if(e)for(var t=e.length-1;t>=0;t--){var a=e[t];a.dom.style.display=r?"":"none",s&&!a.quiet&&(a.dom.innerHTML=s)}}function l(e,r){if(r)for(var s in r)e.style[s]=r[s]}function n(e,r){var s=e.type,n=e.name,i=e._sm,u=i.rule,o=!0,f=[],c=1,p="",g="|"===u.token;if("checkbox"!==s&&"radio"!==s||!e.form)if("select-multiple"===s)for(var m=e.children,h=m.length-1;h>=0;h--)m[h].selected&&m[h].value&&(p+=" ");else p=e.value;else for(var m=e.form.elements[n],h=m.length-1;h>=0;h--)m[h].checked&&(p+=" ");if(r&&"number"==typeof r.forceFlag)c=r.forceFlag,u.server&&(i.serverFlag=c,r.serverMessage&&(i.serverMessage=r.serverMessage),2===c&&(o=i.serverMessage||"no serverMessage!"));else if(u.server)u.required&&!p?(c=2,o=u.required):"number"==typeof i.serverFlag?(c=i.serverFlag,2===c&&(o=i.serverMessage||"no serverMessage!")):p?(c=2,o=u.server):c=0;else if(p)for(var h=u.rules.length-1;h>=0;h--){var v=u.rules[h],y=v.rule;if(y instanceof RegExp){if(!y.test(p)){if(o=v.message,c=2,g)break;f.push(o)}}else if(o=v.params?y.apply(null,[p].concat(v.params)):y.call(null,p),o!==!0){if(c=2,g)break;f.push(o)}}else u.required?(c=2,o=u.required):c=0;return c===i.flag&&i.lastResult===o&&g||(l(e,i.style),a(i.failHtml,!1),a(i.passHtml,!1),g?(i.lastResult=o,i.flag=c):c=f.length?2:1,1===c?(t(i.failCss,!1),t(i.passCss,!0),l(e,u.passStyle),a(i.passHtml,!0),u.pass&&u.pass.call(e)):2===c?(t(i.passCss,!1),t(i.failCss,!0),l(e,u.failStyle),a(i.failHtml,!0,g?o:f.join("<br/>")),u.fail&&u.fail.call(e,g?o:f)):(t(i.failCss,!1),t(i.passCss,!1))),2===c&&d&&(e.scrollIntoView(),d=!1),o}function i(e,r){for(var s=0;s<r.length;s++)e=e.replace("{"+s+"}",r[s]);return e}var u=window.document,o=u.addEventListener?u.addEventListener:u.attachEvent,f="oninput"in u?"input":"propertychange";o.call(u,f,function(e){var r=e.target;!r._sm||r._sm.rule.disinput||r._sm.rule.manul||n(r)}),o.call(u,"change",function(e){var r=e.target;"checkbox"!==r.type&&"radio"!==r.type||n(r)});var c=Object.prototype.hasOwnProperty,p=["required","server","short","disinput","disfocus","disblur","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],g=p.slice(3),m=s.prototype;m.queryInput=function(e){for(var r=this,t=[],a=u.querySelectorAll(e),l=a.length-1;l>=0;l--){var n=a[l],i=n.tagName;if("FORM"===i){n.novalidate="novalidate";for(var f=[],c=n.length-1;c>=0;c--)r.bindInput(n[c])&&f.push(n[c]);t=t.concat(f),r.submit&&f.length&&(n._smInputs=f,o.call(n,"submit",function(e){e.preventDefault();var t=s.validate(e.target._smInputs,{locate:!0,short:r.short});r.submit(t,e.target)}))}else"INPUT"!==i&&"SELECT"!==i&&"TEXTAREA"!==i||r.bindInput(n)&&t.push(n)}return t},m.bindInput=function(e){if(e._sm)return!0;var s=this,t=e.getAttribute("name"),a=e.getAttribute("data-rule"),l=a?this.parseString(a):this.fields[t];if(l){if(e._sm={rule:l,flag:0},!l._isInit){l._isInit=!0,s.handleProperty(l,"required"),s.handleProperty(l,"server"),l.server&&(l.manul=!0);for(var i=g.length-1;i>=0;i--){var f=g[i];r(l,f)||(l[f]=this[f])}s.handleStyle(l,"failStyle"),s.handleStyle(l,"passStyle")}if("checkbox"===e.type||"radio"===e.type){for(var c=u.querySelectorAll('input[name="'+t+'"]'),i=c.length-1;i>=0;i--)c[i]!==e&&(c[i]._sm=e._sm);l.disblur=l.disfocus=l.disinput=!0}return s.recordStyle(e,l.failStyle),s.recordStyle(e,l.passStyle),s.handleHtml(e,"failHtml",l.failHtml),s.handleHtml(e,"passHtml",l.passHtml),s.handleCss(e,"failCss",l.failCss),s.handleCss(e,"passCss",l.passCss),l.disfocus||o.call(e,"focus",function(e){n(e.target,{forceFlag:0})}),l.disblur||o.call(e,"blur",function(e){n(e.target)}),!0}return!1},m.handleProperty=function(e,s){r(e,s)?e[s]===!0&&(e[s]=this[s]):e[s]=!1},m.handleStyle=function(r,s){if(e(r[s]))try{r[s]=JSON.parse(r[s].replace(/'/g,'"'))}catch(e){console.error("error json format: "+r[s])}},m.recordStyle=function(e,r){if(r){e._sm.style||(e._sm.style={});var s=e._sm.style;for(var t in r)s[t]||(s[t]=e.style[t])}},m.handleHtml=function(r,s,t){if(t){r._sm[s]=[],e(t)&&(t=[t]);for(var a=0;a<t.length;a++){var l,n=t[a],i={};if(0===n.indexOf("!")&&(n=n.substring(1),i.quiet=!0),n.indexOf("<")>-1){for(var o=r;0===n.indexOf("+");)n=n.substring(1),o=o.parentNode;var f=u.createElement("div");f.innerHTML=n,l=f.children[0],o.parentNode.insertBefore(l,o.nextElementSibling)}else l=u.querySelector(n);l&&(i.dom=l,l.style.display="none",r._sm[s].push(i))}}},m.handleCss=function(r,s,t){if(t){e(t)&&(t=[t]),r._sm[s]=[];for(var a=t.length-1;a>=0;a--){for(var l=t[a],n=r;0===l.indexOf("+");)l=l.substring(1),n=n.parentNode;r._sm[s].push({target:n,className:l})}}},m.parseRule=function(e,r){var s=e.name,t=this.rules[s]||v.rules[s];t&&(t instanceof Array?r.rules.push({rule:t[0],message:t[1]}):r.rules.push({rule:t,params:e.params}))},m.parseStringFunction=function(e){var r={name:e},s=e.indexOf("(");return s>0&&(r.name=e.substring(0,s),r.params=e.substring(s+1,e.length-1).split(",")),r},m.parseString=function(e){var r={rules:[]},s=e.indexOf("&")>-1?"&":"|",t=e.split(s);r.token=s;for(var a=t.length-1;a>=0;a--){var l=t[a];if(l)if(0===l.indexOf("/")){var n=l.substring(1).split("/");2===n.length?r.rules.push({rule:new RegExp(n[0]),message:n[1]}):3===n.length&&r.rules.push({rule:new RegExp(n[0],"i"),message:n[2]})}else{var i=this.parseStringFunction(l);if(p.indexOf(i.name)>-1){var u=i.name;"failStyle"===u||"passStyle"===u?r[u]=i.params[0]:r[u]=i.params||!0}else this.parseRule(i,r)}}return r},m.parseField=function(r){if(r instanceof Array)return{rules:[{rule:r[0],message:r[1]}]};if(r instanceof Function)return{rules:[{rule:r}]};if(e(r))return this.parseString(r);if("object"==typeof r){if(r.rule instanceof Array)r.rules=[{rule:r.rule[0],message:r.rule[1]}];else if(r.rule instanceof Function)r.rules=[{rule:r.rule}];else if(e(r.rule)){var s=r.rule.split(";");r.rules=[];for(var t=s.length-1;t>=0;t--)s[t]&&this.parseRule(this.parseStringFunction(s[t]),r);delete r.rule}return r}};var h,d,v={server:"not been validated by server",required:"this is required",rules:{}};s.config=function(e){for(var t=p.length-1;t>=0;t--){var a=p[t];r(e,a)&&(v[a]=e[a])}if(e.rules)for(var l in e.rules)v.rules[l]=e.rules[l];h=new s},s.validate=function(r,s){var t=e(r)?h.queryInput(r):r,a=0,l=0,i=!1;s&&(d=s.locate,i=s.short);for(var u=t.length-1;u>=0;u--){var o=t[u];if(o._sm)if(l++,n(o,s)===!0)a++;else if(i)return!1}return l===a},s.reset=function(e){s.validate(e,{forceFlag:0})};var y={number:"only number",email:"wrong email format",range_equal:"value must be equal to {0}",range_scope:"value must be greater than {0} and less than {1}",range_greater:"value must be greater than {0}",range_less:"value must be less than {0}",renge_no_number:"value must be number",error_param:"error param",length_equal:"length must be equal to {0}",length_scope:"length must be greater than {0} and less than {1}",length_greater:"length must be greater than {0}",length_less:"length must be less than {0}",password:"passwords don't match"};s.config({failHtml:'<span style="color:#c00;"></span>',failStyle:{color:"#c00",border:"1px solid #c00"},rules:{number:[/^-?\d+(\.{1}\d+)?$/,y.number],email:[/^[\w\+\-]+(\.[\w\+\-]+)*@[a-z\d\-]+(\.[a-z\d\-]+)*\.([a-z]{2,4})$/i,y.email],range:function(e,r,s){e=1*e;var t=/^-?\d+(\.{1}\d+)?$/;return t.test(e)?r&&!t.test(r)&&s&&!t.test(s)?y.error_param:2===arguments.length?e==r||i(y.range_equal,[r]):3===arguments.length?r&&s?e>r&&e<s||i(y.range_scope,[r,s]):r?e>r||i(y.range_greater,[r]):s?e<s||i(y.range_less,[s]):y.error_param:void 0:y.renge_no_number},length:function(e,r,s){var t=e.length;return 2===arguments.length?t==r||i(y.length_equal,[r]):3===arguments.length?r&&s?t>r&&t<s||i(y.length_scope,[r,s]):r?t>r||i(y.length_greater,[r]):s?t<s||i(y.length_less,[s]):y.error_param:void 0},equal:function(e,r){var s=u.querySelector(r);return e===s.value||y.password}}}),s.setLang=function(e){for(var r in e)y[r]=e[r]};var b={bootstrap:{failStyle:{},failHtml:['!<span class="glyphicon glyphicon-remove form-control-feedback"></span>','<small class="help-block"></small>'],failCss:"++has-error has-feedback",passHtml:'<span class="glyphicon glyphicon-ok form-control-feedback"></span>',passCss:"++has-success has-feedback"},semantic:{failStyle:{},failHtml:['!<i class="remove icon"></i>','+<small class="ui red pointing label"></small>'],failCss:"++error",passHtml:'<i class="checkmark icon"></i>'}};return s.setSkin=function(e){s.config(b[e])},s});