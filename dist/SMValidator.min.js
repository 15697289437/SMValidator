/*!
 * sm-validator 0.12.0
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 * Released under the MIT License.
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e){return"string"==typeof e}function r(e,r){return c.call(e,r)}function s(e,s){var a=this;s||(s={});for(var t=p.length-1;t>=0;t--){var l=p[t];a[l]=r(s,l)?s[l]:h[l]}if(a.fields={},a.rules=s.rules||{},e){a.submit=s.submit;for(var n in s.fields)a.fields[n]=a.parseField(s.fields[n]);a.queryInput(e)}}function a(e,r){if(e)for(var s=e.length-1;s>=0;s--){for(var a=e[s],t=a.target,l=a.className.split(" "),n=t.className.split(" "),i=l.length-1;i>=0;i--){var u=l[i],o=n.indexOf(u);!r&&o>-1?n.splice(o,1):r&&o===-1&&n.push(u)}t.className=n.join(" ")}}function t(e,r,s){if(e)for(var a=e.length-1;a>=0;a--){var t=e[a];t.dom.style.display=r?"":"none",s&&!t.quiet&&(t.dom.innerText=s)}}function l(e,r){if(r)for(var s in r)e.style[s]=r[s]}function n(e,r){var s=e.type,n=e.name,i=e._sm,u=i.rule,o=!0,f=1,c="";if("checkbox"!==s&&"radio"!==s||!e.form)if("select-multiple"===s)for(var p=e.children,m=p.length-1;m>=0;m--)p[m].selected&&p[m].value&&(c+=" ");else c=e.value;else for(var p=e.form.elements[n],m=p.length-1;m>=0;m--)p[m].checked&&(c+=" ");if(r&&"number"==typeof r.forceFlag)f=r.forceFlag,u.server&&(i.serverFlag=f,r.serverMessage&&(i.serverMessage=r.serverMessage),2===f&&(o=i.serverMessage||"no serverMessage!"));else if(u.server)u.required&&!c?(f=2,o=u.required):"number"==typeof i.serverFlag?(f=i.serverFlag,2===f&&(o=i.serverMessage||"no serverMessage!")):c?(f=2,o=u.server):f=0;else if(c)for(var m=u.rules.length-1;m>=0;m--){var g=u.rules[m],h=g.rule;if(h instanceof RegExp){if(!h.test(c)){o=g.message,f=2;break}}else if(o=g.params?h.apply(null,[c].concat(g.params)):h.call(null,c),o!==!0){f=2;break}}else u.required?(f=2,o=u.required):f=0;return f===i.flag&&i.lastResult===o||(i.lastResult=o,i.flag=f,l(e,i.style),t(i.failHtml,!1),t(i.passHtml,!1),1===f?(a(i.failCss,!1),a(i.passCss,!0),l(e,u.passStyle),t(i.passHtml,!0),u.pass&&u.pass.call(e)):2===f?(a(i.passCss,!1),a(i.failCss,!0),l(e,u.failStyle),t(i.failHtml,!0,o),u.fail&&u.fail.call(e)):(a(i.failCss,!1),a(i.passCss,!1))),2===f&&v&&(e.scrollIntoView(),v=!1),o}function i(e,r){for(var s=0;s<r.length;s++)e=e.replace("{"+s+"}",r[s]);return e}var u=window.document,o=u.addEventListener?u.addEventListener:u.attachEvent,f="oninput"in u?"input":"propertychange";o.call(u,f,function(e){var r=e.target;!r._sm||r._sm.rule.manul||r._sm.rule.blur||n(r)}),o.call(u,"change",function(e){var r=e.target;r._sm&&!r._sm.rule.manul&&r._sm.rule.blur&&n(r)});var c=Object.prototype.hasOwnProperty,p=["required","server","blur","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],m=s.prototype;m.queryInput=function(e){for(var r=this,a=[],t=u.querySelectorAll(e),l=t.length-1;l>=0;l--){var n=t[l],i=n.tagName;if("FORM"===i){n.novalidate="novalidate";for(var f=[],c=n.length-1;c>=0;c--)r.bindInput(n[c])&&f.push(n[c]);a=a.concat(f),r.submit&&f.length&&(n._smInputs=f,o.call(n,"submit",function(e){e.preventDefault();var a=s.validate(e.target._smInputs,{locate:!0});r.submit(a,e.target)}))}else"INPUT"!==i&&"SELECT"!==i&&"TEXTAREA"!==i||r.bindInput(n)&&a.push(n)}return a},m.bindInput=function(s){function a(e,s){r(e,s)?e[s]===!0&&(e[s]=this[s]):e[s]=!1}function t(r,s){if(e(r[s]))try{r[s]=JSON.parse(r[s].replace(/'/g,'"'))}catch(e){console.error("error json format: "+r[s])}}function l(e,r){if(r){e._sm.style||(e._sm.style={});var s=e._sm.style;for(var a in r)s[a]||(s[a]=e.style[a])}}function n(r,s,a){if(a){r._sm[s]=[],e(a)&&(a=[a]);for(var t=0;t<a.length;t++){var l,n=a[t],i={};if(0===n.indexOf("!")&&(n=n.substring(1),i.quiet=!0),n.indexOf("<")>-1){for(var o=r;0===n.indexOf("+");)n=n.substring(1),o=o.parentNode;var f=u.createElement("div");f.innerHTML=n,l=f.children[0],o.parentNode.insertBefore(l,o.nextElementSibling)}else l=u.querySelector(n);l&&(i.dom=l,l.style.display="none",r._sm[s].push(i))}}}function i(r,s,a){if(a){e(a)&&(a=[a]),r._sm[s]=[];for(var t=a.length-1;t>=0;t--){for(var l=a[t],n=r;0===l.indexOf("+");)l=l.substring(1),n=n.parentNode;r._sm[s].push({target:n,className:l})}}}if(s._sm)return!0;var o=s.getAttribute("name"),f=s.getAttribute("data-rule"),c=f?this.parseString(f):this.fields[o];if(c){if(s._sm={rule:c,flag:0},"checkbox"===s.type||"radio"===s.type){for(var m=u.querySelectorAll('input[name="'+o+'"]'),g=m.length-1;g>=0;g--)m[g]!==s&&(m[g]._sm=s._sm);c.blur=!0}if(!c._isInit){c._isInit=!0,a.call(this,c,"required"),a.call(this,c,"server"),c.server&&(c.manul=!0);for(var g=p.length-1;g>=0;g--){var v=p[g];r(c,v)||(c[v]=this[v])}t(c,"failStyle"),t(c,"passStyle")}return l(s,c.failStyle),l(s,c.passStyle),n(s,"failHtml",c.failHtml),n(s,"passHtml",c.passHtml),i(s,"failCss",c.failCss),i(s,"passCss",c.passCss),!0}return!1},m.parseRule=function(e,r){var s=e.name,a=this.rules[s]||h.rules[s];a&&(a instanceof Array?r.rules.push({rule:a[0],message:a[1]}):r.rules.push({rule:a,params:e.params}))},m.parseStringFunction=function(e){var r={name:e},s=e.indexOf("(");return s>0&&(r.name=e.substring(0,s),r.params=e.substring(s+1,e.length-1).split(",")),r},m.parseString=function(e){for(var r={rules:[]},s=e.split(";"),a=s.length-1;a>=0;a--){var t=s[a];if(t)if(0===t.indexOf("/")){var l=t.substring(1).split("/");2===l.length?r.rules.push({rule:new RegExp(l[0]),message:l[1]}):3===l.length&&r.rules.push({rule:new RegExp(l[0],"i"),message:l[2]})}else{var n=this.parseStringFunction(t);if(p.indexOf(n.name)>-1){var i=n.name;"failStyle"===i||"passStyle"===i?r[i]=n.params[0]:r[i]=n.params||!0}else this.parseRule(n,r)}}return r},m.parseField=function(r){if(r instanceof Array)return{rules:[{rule:r[0],message:r[1]}]};if(r instanceof Function)return{rules:[{rule:r}]};if(e(r))return this.parseString(r);if("object"==typeof r){if(r.rule instanceof Array)r.rules=[{rule:r.rule[0],message:r.rule[1]}];else if(r.rule instanceof Function)r.rules=[{rule:r.rule}];else if(e(r.rule)){var s=r.rule.split(";");r.rules=[];for(var a=s.length-1;a>=0;a--)s[a]&&this.parseRule(this.parseStringFunction(s[a]),r);delete r.rule}return r}};var g,v,h={server:"not been validated by server",required:"this is required",rules:{}};s.config=function(e){for(var a=p.length-1;a>=0;a--){var t=p[a];r(e,t)&&(h[t]=e[t])}if(e.rules)for(var l in e.rules)h.rules[l]=e.rules[l];g=new s},s.validate=function(r,s){var a=e(r)?g.queryInput(r):r,t=0,l=0;s&&s.locate&&(v=!0);for(var i=a.length-1;i>=0;i--){var u=a[i];u._sm&&(l++,n(u,s)===!0&&t++)}return l===t},s.reset=function(e){s.validate(e,{forceFlag:0})};var d={number:"only number",email:"wrong email format",range_equal:"value must be equal to {0}",range_scope:"value must be greater than {0} and less than {1}",range_greater:"value must be greater than {0}",range_less:"value must be less than {0}",renge_no_number:"value must be number",error_param:"error param",length_equal:"length must be equal to {0}",length_scope:"length must be greater than {0} and less than {1}",length_greater:"length must be greater than {0}",length_less:"length must be less than {0}",password:"passwords don't match"};s.config({failHtml:'<span style="color:#c00;"></span>',failStyle:{color:"#c00",border:"1px solid #c00"},rules:{number:[/^-?\d+(\.{1}\d+)?$/,d.number],email:[/^[\w\+\-]+(\.[\w\+\-]+)*@[a-z\d\-]+(\.[a-z\d\-]+)*\.([a-z]{2,4})$/i,d.email],range:function(e,r,s){e=1*e;var a=/^-?\d+(\.{1}\d+)?$/;return a.test(e)?r&&!a.test(r)&&s&&!a.test(s)?d.error_param:2===arguments.length?e==r||i(d.range_equal,[r]):3===arguments.length?r&&s?e>r&&e<s||i(d.range_scope,[r,s]):r?e>r||i(d.range_greater,[r]):s?e<s||i(d.range_less,[s]):d.error_param:void 0:d.renge_no_number},length:function(e,r,s){var a=e.length;return 2===arguments.length?a==r||i(d.length_equal,[r]):3===arguments.length?r&&s?a>r&&a<s||i(d.length_scope,[r,s]):r?a>r||i(d.length_greater,[r]):s?a<s||i(d.length_less,[s]):d.error_param:void 0},equal:function(e,r){var s=u.querySelector(r);return e===s.value||d.password}}}),s.setLang=function(e){for(var r in e)d[r]=e[r]};var b={bootstrap:{failStyle:{},failHtml:['!<span class="glyphicon glyphicon-remove form-control-feedback"></span>','<small class="help-block"></small>'],failCss:"++has-error has-feedback",passHtml:'<span class="glyphicon glyphicon-ok form-control-feedback"></span>',passCss:"++has-success has-feedback"},semantic:{failStyle:{},failHtml:['!<i class="remove icon"></i>','+<small class="ui red pointing label"></small>'],failCss:"++error",passHtml:'<i class="checkmark icon"></i>'}};return s.setSkin=function(e){s.config(b[e])},s});