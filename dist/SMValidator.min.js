/*!
 * SMValidator 1.1.0
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 * Released under the MIT License.
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e){return"checkbox"===e||"radio"===e}function r(e){return"string"==typeof e}function s(e,r){return m.call(e,r)}function t(e,r){var t=this;r||(r={});for(var n=g.length-1;n>=0;n--){var a=g[n];t[a]=s(r,a)?r[a]:b[a]}if(t.fields={},t.rules=r.rules||{},e){t.submit=r.submit;for(var l in r.fields)t.fields[l]=t.parseField(r.fields[l]);t.queryInput(e)}}function n(e,r){if(e)for(var s=e.length-1;s>=0;s--){for(var t=e[s],n=t.target,a=t.className.split(" "),l=n.className.split(" "),i=a.length-1;i>=0;i--){var u=a[i],o=l.indexOf(u);!r&&o>-1?l.splice(o,1):r&&o===-1&&l.push(u)}n.className=l.join(" ")}}function a(e,r,s){if(e)for(var t=e.length-1;t>=0;t--){var n=e[t];n.dom.style.display=r?"":"none",s&&!n.quiet&&(n.dom.innerHTML=s)}}function l(e,r){if(r)for(var s in r)e.style[s]=r[s]}function i(e){var r=e._sm;l(e,r.style),a(r.failHtml,!1),a(r.passHtml,!1),n(r.failCss,!1),n(r.passCss,!1)}function u(r,s){var t=r.type,u=r.name,o=r._sm,f=o.rule,c=!0,p=[],m=1,g="",h="|"===f.token;if(e(t)&&r.form)for(var d=r.form.elements[u],v=d.length-1;v>=0;v--)d[v].checked&&(g+=" ");else if("select-multiple"===t)for(var d=r.children,v=d.length-1;v>=0;v--)d[v].selected&&d[v].value&&(g+=" ");else g=r.value;if(s&&"number"==typeof s.forceFlag)m=s.forceFlag,f.async&&(o.asyncFlag=m,s.asyncMessage&&(o.asyncMessage=s.asyncMessage),2===m&&(c=o.asyncMessage||"no asyncMessage!"));else if(f.async)f.required&&!g?(m=2,c=f.required):"number"==typeof o.asyncFlag?(m=o.asyncFlag,2===m&&(c=o.asyncMessage||"no asyncMessage!")):g?(m=2,c=f.async):m=0;else if(g)for(var v=f.rules.length-1;v>=0;v--){var b=f.rules[v],_=b.rule;if(_ instanceof RegExp){if(!_.test(g)){if(c=b.message,m=2,h)break;p.push(c)}}else if(c=b.params?_.apply(null,[g].concat(b.params)):_.call(null,g),c!==!0){if(m=2,h)break;p.push(c)}}else f.required?(m=2,c=f.required,h||p.push(c)):m=0;return h||(m=p.length?2:1),i(r),1===m?(n(o.failCss,!1),n(o.passCss,!0),l(r,f.passStyle),a(o.passHtml,!0),f.pass&&f.pass.call(r)):2===m&&(n(o.passCss,!1),n(o.failCss,!0),l(r,f.failStyle),a(o.failHtml,!0,h?c:p.join("<br/>")),f.fail&&f.fail.call(r,h?c:p)),2===m&&y&&(r.scrollIntoView(),y=!1),c}function o(e,r){for(var s=0;s<r.length;s++)e=e.replace("{"+s+"}",r[s]);return e}var f=window.document,c=f.addEventListener?f.addEventListener:f.attachEvent,p="oninput"in f?"input":"propertychange";c.call(f,p,function(e){var r=e.target;!r._sm||r._sm.rule.disinput||r._sm.rule.manul||u(r)}),c.call(f,"change",function(r){var s=r.target;e(s.type)&&s._sm&&!s._sm.rule.manul&&u(s)});var m=Object.prototype.hasOwnProperty,g=["required","async","short","disinput","disblur","focus","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],h=g.slice(3),d=t.prototype;d.queryInput=function(e){for(var r=this,s=[],n=f.querySelectorAll(e),a=n.length-1;a>=0;a--){var l=n[a],i=l.tagName;if("FORM"===i){l.novalidate="novalidate";for(var u=[],o=l.length-1;o>=0;o--)r.bindInput(l[o])&&u.push(l[o]);s=s.concat(u),r.submit&&u.length&&(l._smInputs=u,c.call(l,"submit",function(e){e.preventDefault();var s=t.validate(e.target._smInputs,{locate:!0,short:r.short});r.submit(s,e.target)}))}else"INPUT"!==i&&"SELECT"!==i&&"TEXTAREA"!==i||r.bindInput(l)&&s.push(l)}return s},d.bindInput=function(r){if(r._sm)return!0;var t=this,n=r.getAttribute("name"),a=r.getAttribute("data-rule"),l=a?this.parseString(a):this.fields[n];if(l){if(r._sm={rule:l,flag:0},!l._isInit){l._isInit=!0,t.handleProperty(l,"required"),t.handleProperty(l,"async"),l.async&&(l.manul=!0);for(var o=h.length-1;o>=0;o--){var p=h[o];s(l,p)||(l[p]=this[p])}t.handleStyle(l,"failStyle"),t.handleStyle(l,"passStyle")}if(e(r.type)){for(var m=f.querySelectorAll('input[name="'+n+'"]'),o=m.length-1;o>=0;o--)m[o]!==r&&(m[o]._sm=r._sm);l.disblur=l.disinput=!0,l.focus=!1}return t.recordStyle(r,l.failStyle),t.recordStyle(r,l.passStyle),t.handleHtml(r,"failHtml",l.failHtml),t.handleHtml(r,"passHtml",l.passHtml),t.handleCss(r,"failCss",l.failCss),t.handleCss(r,"passCss",l.passCss),l.focus&&c.call(r,"focus",function(e){i(e.target)}),l.disblur||c.call(r,"blur",function(e){u(e.target)}),!0}return!1},d.handleProperty=function(e,r){s(e,r)?e[r]===!0&&(e[r]=this[r]):e[r]=!1},d.handleStyle=function(e,s){if(r(e[s]))try{e[s]=JSON.parse(e[s].replace(/'/g,'"'))}catch(r){console.error("error json format: "+e[s])}},d.recordStyle=function(e,r){if(r){e._sm.style||(e._sm.style={});var s=e._sm.style;for(var t in r)s[t]||(s[t]=e.style[t])}},d.handleHtml=function(e,s,t){if(t){e._sm[s]=[],r(t)&&(t=[t]);for(var n=0;n<t.length;n++){var a,l=t[n],i={};if(0===l.indexOf("!")&&(l=l.substring(1),i.quiet=!0),l.indexOf("<")>-1){for(var u=e;0===l.indexOf("+");)l=l.substring(1),u=u.parentNode;var o=f.createElement("div");o.innerHTML=l,a=o.children[0],u.parentNode.insertBefore(a,u.nextElementSibling)}else a=f.querySelector(l);a&&(i.dom=a,a.style.display="none",e._sm[s].push(i))}}},d.handleCss=function(e,s,t){if(t){r(t)&&(t=[t]),e._sm[s]=[];for(var n=t.length-1;n>=0;n--){for(var a=t[n],l=e;0===a.indexOf("+");)a=a.substring(1),l=l.parentNode;e._sm[s].push({target:l,className:a})}}},d.parseRule=function(e,r){var s=e.name,t=this.rules[s]||b.rules[s];t&&(t instanceof Array?r.rules.push({rule:t[0],message:t[1]}):r.rules.push({rule:t,params:e.params}))},d.parseStringFunction=function(e){var r={name:e},s=e.indexOf("(");return s>0&&(r.name=e.substring(0,s),r.params=e.substring(s+1,e.length-1).split(",")),r},d.parseString=function(e){var r={rules:[]},s=e.indexOf("&")>-1?"&":"|",t=e.split(s);r.token=s;for(var n=t.length-1;n>=0;n--){var a=t[n];if(a)if(0===a.indexOf("/")){var l=a.substring(1).split("/");2===l.length?r.rules.push({rule:new RegExp(l[0]),message:l[1]}):3===l.length&&r.rules.push({rule:new RegExp(l[0],"i"),message:l[2]})}else{var i=this.parseStringFunction(a),u=i.name,o=!0;if("!"===u.charAt(0)&&(u=u.substring(1),o=!1),g.indexOf(u)>-1){var f=i.params;f?r[u]="failStyle"===u||"passStyle"===u?f[0]:f:r[u]=o}else this.parseRule(i,r)}}return r},d.parseField=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if(r(e))return this.parseString(e);if("object"==typeof e){if(e.token="|",e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if(r(e.rule)){var s=e.rule;delete e.rule,s.indexOf("&")>-1&&(e.token="&");var t=s.split(e.token);e.rules=[];for(var n=t.length-1;n>=0;n--)t[n]&&this.parseRule(this.parseStringFunction(t[n]),e)}return e}};var v,y,b={async:"not been validated by async",required:"this is required",rules:{}};t.config=function(e){for(var r=g.length-1;r>=0;r--){var n=g[r];s(e,n)&&(b[n]=e[n])}if(e.rules)for(var a in e.rules)b.rules[a]=e.rules[a];v=new t},t.validate=function(e,s){var t=r(e)?v.queryInput(e):e,n=0,a=0,l=!1;s&&(y=s.locate,l=s.short);for(var i=t.length-1;i>=0;i--){var o=t[i];if(o._sm)if(a++,u(o,s)===!0)n++;else if(l)return!1}return a===n},t.reset=function(e){for(var s=r(e)?v.queryInput(e):e,t=s.length-1;t>=0;t--)i(s[t])};var _={number:"only number",email:"wrong email format",range_equal:"value must be equal to {0}",range_scope:"value must be greater than {0} and less than {1}",range_greater:"value must be greater than {0}",range_less:"value must be less than {0}",renge_no_number:"value must be number",error_param:"error param",length_equal:"length must be equal to {0}",length_scope:"length must be greater than {0} and less than {1}",length_greater:"length must be greater than {0}",length_less:"length must be less than {0}",password:"passwords don't match"};t.config({failHtml:'<span style="color:#c00;"></span>',failStyle:{color:"#c00",border:"1px solid #c00"},rules:{number:[/^-?\d+(\.{1}\d+)?$/,_.number],email:[/^[\w\+\-]+(\.[\w\+\-]+)*@[a-z\d\-]+(\.[a-z\d\-]+)*\.([a-z]{2,4})$/i,_.email],range:function(e,r,s){e=1*e;var t=/^-?\d+(\.{1}\d+)?$/;return t.test(e)?r&&!t.test(r)&&s&&!t.test(s)?_.error_param:2===arguments.length?e==r||o(_.range_equal,[r]):3===arguments.length?r&&s?e>r&&e<s||o(_.range_scope,[r,s]):r?e>r||o(_.range_greater,[r]):s?e<s||o(_.range_less,[s]):_.error_param:void 0:_.renge_no_number},length:function(e,r,s){var t=e.length;return 2===arguments.length?t==r||o(_.length_equal,[r]):3===arguments.length?r&&s?t>r&&t<s||o(_.length_scope,[r,s]):r?t>r||o(_.length_greater,[r]):s?t<s||o(_.length_less,[s]):_.error_param:void 0},equal:function(e,r){var s=f.querySelector(r);return e===s.value||_.password}}}),t.setLang=function(e){for(var r in e)_[r]=e[r]};var S={bootstrap:{failStyle:{},failHtml:['!<span class="glyphicon glyphicon-remove form-control-feedback"></span>','<small class="help-block"></small>'],failCss:"++has-error has-feedback",passHtml:'<span class="glyphicon glyphicon-ok form-control-feedback"></span>',passCss:"++has-success has-feedback"},semantic:{failStyle:{},failHtml:['!<i class="remove icon"></i>','+<small class="ui red pointing label"></small>'],failCss:"++error",passHtml:'<i class="checkmark icon"></i>'}};return t.setSkin=function(e){t.config(S[e])},t});