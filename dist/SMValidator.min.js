/*!
 * SMValidator.js 0.9.3
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e){e&&e.required&&(delete e.required,console.warn('"required" customized rule is invalid'))}function r(r,s){if(r){var a=this;s||(s={});for(var t=f.length-1;t>=0;t--){var n=f[t];a[n]=s[n]||c[n]}e(s.rules),a.rules=s.rules||{},a.submit=s.submit,a.fields={};for(var l in s.fields)a.fields[l]=a.parseField(s.fields[l]);a.queryInput(r)}}function s(e,r){if(e)for(var s=e.length-1;s>=0;s--){var a=e[s],t=a.target,n=a.className,l=t.className.split(" "),i=l.indexOf(n);!r&&i>-1?(l.splice(i,1),t.className=l.join(" ")):r&&i===-1&&(t.className+=t.className?" "+n:n)}}function a(e,r){if(e)for(var s=e.length-1;s>=0;s--)e[s].style.display=r?"":"none"}function t(e,r){if(r)for(var s in r)e.style[s]=r[s]}function n(e,r){var n=e._sm,l=n.rule,i=!0,u=1;if(r&&"number"==typeof r.forceFlag)u=r.forceFlag,l.server&&(n.serverFlag=u,r.serverMessage&&(n.serverMessage=r.serverMessage),2===u&&(n.ruleIndex=-2,i=n.serverMessage||"no reason"));else if(l.server)l.required&&!e.value?(u=2,n.ruleIndex=-1,i=c.requiredMessage):"number"==typeof n.serverFlag?(u=n.serverFlag,2===u&&(n.ruleIndex=-2,i=n.serverMessage||"no reason")):e.value?(u=2,n.ruleIndex=-3,i=c.noServerMessage):u=0;else if(l.required||""!==e.value)for(var f=l.rules.length-1;f>=0;f--){var o=l.rules[f],p=o.rule;if(p instanceof RegExp){if(!p.test(e.value)){i=o.message,n.ruleIndex=f,u=2;break}}else if(i=o.params?p.apply(null,[e.value].concat(o.params)):p.call(null,e.value),i!==!0){n.ruleIndex=f,u=2;break}}else u=0;return u===n.flag&&n.ruleIndex===n.lastRuleIndex||(n.lastRuleIndex=n.ruleIndex,n.flag=u,t(e,n.style),a(n.failHtml,!1),a(n.passHtml,!1),1===u?(s(n.failCss,!1),s(n.passCss,!0),t(e,l.passStyle),a(n.passHtml,!0),l.pass&&l.pass.call(e)):2===u?(s(n.passCss,!1),s(n.failCss,!0),t(e,l.failStyle),a(n.failHtml,!0),n.failHtml&&!n._quiet&&(n.failHtml[0].innerText=i),l.fail&&l.fail.call(e)):(s(n.failCss,!1),s(n.passCss,!1))),2===u&&c._useLocate&&(e.scrollIntoView(),c._useLocate=!1),i}var l=window.document,i=l.addEventListener?l.addEventListener:l.attachEvent,u="oninput"in l?"input":"propertychange";i.call(l,u,function(e){var r=e.target;!r._sm||r._sm.rule.manul||r._sm.rule.blur||n(r)}),i.call(l,"change",function(e){var r=e.target;r._sm&&!r._sm.rule.manul&&n(r)});var f=["server","blur","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],o=r.prototype;o.queryInput=function(e){for(var s=this,a=[],t=l.querySelectorAll(e),n=t.length-1;n>=0;n--){var u=t[n];if("FORM"===u.tagName){u.novalidate="novalidate";for(var f=[],o=u.length-1;o>=0;o--)s.bindInput(u[o])&&f.push(u[o]);a=a.concat(f),s.submit&&f.length&&(u._smInputs=f,i.call(u,"submit",function(e){e.preventDefault();var a=r.validate(e.target._smInputs,{locate:!0});s.submit(a,e.target)}))}else"INPUT"===u.tagName&&s.bindInput(u)&&a.push(u)}return a},o.bindInput=function(e){function r(e,r){if("string"==typeof e[r])try{e[r]=JSON.parse(e[r].replace(/'/g,'"'))}catch(s){console.error("error json format: "+e[r])}}function s(e,r){if(r){e._sm.style||(e._sm.style={});var s=e._sm.style;for(var a in r)s[a]||(s[a]=e.style[a])}}function a(e,r,s){if(s){"string"==typeof s&&(s=[s]),e._sm[r]=[];for(var a=0;a<s.length;a++){var t,n=s[a];if(0===a&&0===n.indexOf("!")&&(n=n.substring(1),e._sm._quiet=!0),0===n.indexOf("<")){var i=l.createElement("div");i.innerHTML=n,t=i.childNodes[0],e.parentNode.insertBefore(t,e.nextElementSibling)}else t=l.querySelector(n);t&&(t.style.display="none",e._sm[r].push(t))}}}function t(e,r,s){if(s){"string"==typeof s&&(s=[s]),e._sm[r]=[];for(var a=s.length-1;a>=0;a--){for(var t=s[a],n=e;0===t.indexOf("+");)t=t.substring(1),n=n.parentNode;e._sm[r].push({target:n,className:t})}}}if(e._sm)return!0;var n=e.getAttribute("name"),i=e.getAttribute("data-rule"),u=i?this.parseString(i):this.fields[n];if(u){if(e._sm={rule:u,flag:0},!u._isInit){u._isInit=!0;for(var o=f.length-1;o>=0;o--){var c=f[o];u[c]||(u[c]=this[c])}u.server&&(u.manul=!0),r(u,"failStyle"),r(u,"passStyle")}return s(e,u.failStyle),s(e,u.passStyle),a(e,"failHtml",u.failHtml),a(e,"passHtml",u.passHtml),t(e,"failCss",u.failCss),t(e,"passCss",u.passCss),!0}return!1},o.parseRule=function(e,r){var s=e.name,a=this.rules[s]||c.rules[s];a&&(a instanceof Array?r.rules.push({rule:a[0],message:a[1]}):r.rules.push({rule:a,params:e.params}),r.required="required"===s)},o.parseStringFunction=function(e){var r={name:e},s=e.indexOf("(");return s>0&&(r.name=e.substring(0,s),r.params=e.substring(s+1,e.length-1).split(",")),r},o.parseString=function(e){for(var r={rules:[]},s=e.split(";"),a=s.length-1;a>=0;a--){var t=s[a];if(""!==t)if(0===t.indexOf("/")){var n=t.substring(1).split("/");2===n.length?r.rules.push({rule:new RegExp(n[0]),message:n[1]}):3===n.length&&r.rules.push({rule:new RegExp(n[0],"i"),message:n[2]})}else{var l=this.parseStringFunction(t);if(f.indexOf(l.name)>-1){var i=l.name;"blur"===i||"manul"===i||"server"===i?r[i]=!0:"failStyle"===i||"passStyle"===i?r[i]=l.params[0]:r[i]=l.params}else this.parseRule(l,r)}}return r},o.parseField=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if("string"==typeof e)return this.parseString(e);if("object"==typeof e){if(e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if("string"==typeof e.rule){var r=e.rule.split(";");e.rules=[];for(var s=r.length-1;s>=0;s--)""!==r[s]&&this.parseRule(this.parseStringFunction(r[s]),e);delete e.rule}return e}};var c={noServerMessage:"not been validated by server",requiredMessage:"this is required",rules:{required:function(e){return!!e||c.requiredMessage}}};r.config=function(r){for(var s=f.concat(["noServerMessage","requiredMessage"]),a=s.length-1;a>=0;a--){var t=s[a];r[t]&&(c[t]=r[t])}if(r.rules){e(r.rules);for(var n in r.rules)c.rules[n]=r.rules[n]}};var p=new r;p.rules=p.fields={},r.validate=function(e,r){var s="string"==typeof e?p.queryInput(e):e,a=0,t=0;r&&r.locate&&(c._useLocate=!0);for(var l=s.length-1;l>=0;l--){var i=s[l];i._sm&&(t++,n(i,r)===!0&&a++)}return t===a},r.reset=function(e){r.validate(e,{forceFlag:0})},r.config({requiredMessage:"这是必填字段",noServerMessage:"还没经过服务器验证",rules:{number:[/^-?\d+$/,"只能输入数字"],email:[/^[\w\+\-]+(\.[\w\+\-]+)*@[a-z\d\-]+(\.[a-z\d\-]+)*\.([a-z]{2,4})$/i,"邮箱格式不正确"],range:function(e,r,s){e=1*e;var a=/^-?\d+$/;return a.test(e)?r&&!a.test(r)&&s&&!a.test(s)?"无效参数":2===arguments.length?e==r||"值必须等于"+r:3===arguments.length?r&&s?e>r&&e<s||"值必须大于 "+r+" 且小于 "+s:r?e>r||"值必须大于 "+r:s?e<s||"值必须小于 "+s:"无效参数":void 0:"不是数字"},length:function(e,r,s){var a=e.length;return 2===arguments.length?a==r||"长度必须等于"+r:3===arguments.length?r&&s?a>r&&a<s||"长度必须大于 "+r+" 且小于 "+s:r?a>r||"长度必须大于 "+r:s?a<s||"长度必须小于 "+s:"无效参数":void 0},equal:function(e,r){var s=l.querySelector(r);return e===s.value||"您输入的密码不一致"}}});var g={bootstrap:{failHtml:['<small class="help-block"></small>','<i class="form-control-feedback glyphicon glyphicon-remove"></i>'],failCss:["++has-error","++has-feedback"],passHtml:'<span class="glyphicon glyphicon-ok form-control-feedback"></span>',passCss:["++has-success","++has-feedback"]}};return r.setSkin=function(e){r.config(g[e])},r.setSkin("bootstrap"),r});