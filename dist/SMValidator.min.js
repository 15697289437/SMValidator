/*!
 * sm-validator 0.9.7
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 */!function(e,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):e.SMValidator=s()}(this,function(){"use strict";function e(e){e&&e.required&&(delete e.required,console.warn('"required" customized rule is invalid'))}function s(e){return"string"==typeof e}function r(s,r){var a=this;r||(r={});for(var t=f.length-1;t>=0;t--){var l=f[t];a[l]=r[l]||m[l]}if(a.fields={},a.rules=r.rules||{},s){e(r.rules),a.submit=r.submit;for(var n in r.fields)a.fields[n]=a.parseField(r.fields[n]);a.queryInput(s)}}function a(e,s){if(e)for(var r=e.length-1;r>=0;r--){for(var a=e[r],t=a.target,l=a.className.split(" "),n=t.className.split(" "),i=l.length-1;i>=0;i--){var u=l[i],o=n.indexOf(u);!s&&o>-1?n.splice(o,1):s&&o===-1&&n.push(u)}t.className=n.join(" ")}}function t(e,s,r){if(e)for(var a=e.length-1;a>=0;a--){var t=e[a];t.dom.style.display=s?"":"none",r&&!t.quiet&&(t.dom.innerText=r)}}function l(e,s){if(s)for(var r in s)e.style[r]=s[r]}function n(e,s){var r=e._sm,n=r.rule,i=!0,u=1;if(s&&"number"==typeof s.forceFlag)u=s.forceFlag,n.server&&(r.serverFlag=u,s.serverMessage&&(r.serverMessage=s.serverMessage),2===u&&(i=r.serverMessage||"no reason"));else if(n.server)n.required&&!e.value?(u=2,i=m.requiredMessage):"number"==typeof r.serverFlag?(u=r.serverFlag,2===u&&(i=r.serverMessage||"no reason")):e.value?(u=2,i=m.noServerMessage):u=0;else if(n.required||""!==e.value)for(var o=n.rules.length-1;o>=0;o--){var f=n.rules[o],c=f.rule;if(c instanceof RegExp){if(!c.test(e.value)){i=f.message,u=2;break}}else if(i=f.params?c.apply(null,[e.value].concat(f.params)):c.call(null,e.value),i!==!0){u=2;break}}else u=0;return u===r.flag&&r.lastResult===i||(r.lastResult=i,r.flag=u,l(e,r.style),t(r.failHtml,!1),t(r.passHtml,!1),1===u?(a(r.failCss,!1),a(r.passCss,!0),l(e,n.passStyle),t(r.passHtml,!0),n.pass&&n.pass.call(e)):2===u?(a(r.passCss,!1),a(r.failCss,!0),l(e,n.failStyle),t(r.failHtml,!0,i),n.fail&&n.fail.call(e)):(a(r.failCss,!1),a(r.passCss,!1))),2===u&&m._useLocate&&(e.scrollIntoView(),m._useLocate=!1),i}var i=window.document,u=i.addEventListener?i.addEventListener:i.attachEvent,o="oninput"in i?"input":"propertychange";u.call(i,o,function(e){var s=e.target;!s._sm||s._sm.rule.manul||s._sm.rule.blur||n(s)}),u.call(i,"change",function(e){var s=e.target;s._sm&&!s._sm.rule.manul&&n(s)});var f=["server","blur","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],c=r.prototype;c.queryInput=function(e){for(var s=this,a=[],t=i.querySelectorAll(e),l=t.length-1;l>=0;l--){var n=t[l];if("FORM"===n.tagName){n.novalidate="novalidate";for(var o=[],f=n.length-1;f>=0;f--)s.bindInput(n[f])&&o.push(n[f]);a=a.concat(o),s.submit&&o.length&&(n._smInputs=o,u.call(n,"submit",function(e){e.preventDefault();var a=r.validate(e.target._smInputs,{locate:!0});s.submit(a,e.target)}))}else"INPUT"===n.tagName&&s.bindInput(n)&&a.push(n)}return a},c.bindInput=function(e){function r(e,r){if(s(e[r]))try{e[r]=JSON.parse(e[r].replace(/'/g,'"'))}catch(s){console.error("error json format: "+e[r])}}function a(e,s){if(s){e._sm.style||(e._sm.style={});var r=e._sm.style;for(var a in s)r[a]||(r[a]=e.style[a])}}function t(e,r,a){if(a){e._sm[r]=[],s(a)&&(a=[a]);for(var t=0;t<a.length;t++){var l,n=a[t],u={};if(0===n.indexOf("!")&&(n=n.substring(1),u.quiet=!0),n.indexOf("<")>-1){for(var o=e;0===n.indexOf("+");)n=n.substring(1),o=o.parentNode;var f=i.createElement("div");f.innerHTML=n,l=f.childNodes[0],o.parentNode.insertBefore(l,o.nextElementSibling)}else l=i.querySelector(n);l&&(u.dom=l,l.style.display="none",e._sm[r].push(u))}}}function l(e,r,a){if(a){s(a)&&(a=[a]),e._sm[r]=[];for(var t=a.length-1;t>=0;t--){for(var l=a[t],n=e;0===l.indexOf("+");)l=l.substring(1),n=n.parentNode;e._sm[r].push({target:n,className:l})}}}if(e._sm)return!0;var n=e.getAttribute("name"),u=e.getAttribute("data-rule"),o=u?this.parseString(u):this.fields[n];if(o){if(e._sm={rule:o,flag:0},!o._isInit){o._isInit=!0;for(var c=f.length-1;c>=0;c--){var p=f[c];o[p]||(o[p]=this[p])}o.server&&(o.manul=!0),r(o,"failStyle"),r(o,"passStyle")}return a(e,o.failStyle),a(e,o.passStyle),t(e,"failHtml",o.failHtml),t(e,"passHtml",o.passHtml),l(e,"failCss",o.failCss),l(e,"passCss",o.passCss),!0}return!1},c.parseRule=function(e,s){var r=e.name,a=this.rules[r]||m.rules[r];a&&(a instanceof Array?s.rules.push({rule:a[0],message:a[1]}):s.rules.push({rule:a,params:e.params}),s.required="required"===r)},c.parseStringFunction=function(e){var s={name:e},r=e.indexOf("(");return r>0&&(s.name=e.substring(0,r),s.params=e.substring(r+1,e.length-1).split(",")),s},c.parseString=function(e){for(var s={rules:[]},r=e.split(";"),a=r.length-1;a>=0;a--){var t=r[a];if(t)if(0===t.indexOf("/")){var l=t.substring(1).split("/");2===l.length?s.rules.push({rule:new RegExp(l[0]),message:l[1]}):3===l.length&&s.rules.push({rule:new RegExp(l[0],"i"),message:l[2]})}else{var n=this.parseStringFunction(t);if(f.indexOf(n.name)>-1){var i=n.name;"blur"===i||"manul"===i||"server"===i?s[i]=!0:"failStyle"===i||"passStyle"===i?s[i]=n.params[0]:s[i]=n.params}else this.parseRule(n,s)}}return s},c.parseField=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if(s(e))return this.parseString(e);if("object"==typeof e){if(e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if(s(e.rule)){var r=e.rule.split(";");e.rules=[];for(var a=r.length-1;a>=0;a--)""!==r[a]&&this.parseRule(this.parseStringFunction(r[a]),e);delete e.rule}return e}};var p,m={noServerMessage:"not been validated by server",requiredMessage:"this is required",rules:{required:function(e){return!!e||m.requiredMessage}}};r.config=function(s){for(var a=f.concat(["noServerMessage","requiredMessage"]),t=a.length-1;t>=0;t--){var l=a[t];s[l]&&(m[l]=s[l])}if(s.rules){e(s.rules);for(var n in s.rules)m.rules[n]=s.rules[n]}p=new r},r.validate=function(e,r){var a=s(e)?p.queryInput(e):e,t=0,l=0;r&&r.locate&&(m._useLocate=!0);for(var i=a.length-1;i>=0;i--){var u=a[i];u._sm&&(l++,n(u,r)===!0&&t++)}return l===t},r.reset=function(e){r.validate(e,{forceFlag:0})},r.config({requiredMessage:"这是必填字段",noServerMessage:"还没经过服务器验证",failHtml:'<span style="color:#c00;"></span>',failStyle:{color:"#c00",border:"1px solid #c00"},rules:{number:[/^-?\d+$/,"只能输入数字"],email:[/^[\w\+\-]+(\.[\w\+\-]+)*@[a-z\d\-]+(\.[a-z\d\-]+)*\.([a-z]{2,4})$/i,"邮箱格式不正确"],range:function(e,s,r){e=1*e;var a=/^-?\d+$/;return a.test(e)?s&&!a.test(s)&&r&&!a.test(r)?"无效参数":2===arguments.length?e==s||"值必须等于"+s:3===arguments.length?s&&r?e>s&&e<r||"值必须大于 "+s+" 且小于 "+r:s?e>s||"值必须大于 "+s:r?e<r||"值必须小于 "+r:"无效参数":void 0:"不是数字"},length:function(e,s,r){var a=e.length;return 2===arguments.length?a==s||"长度必须等于"+s:3===arguments.length?s&&r?a>s&&a<r||"长度必须大于 "+s+" 且小于 "+r:s?a>s||"长度必须大于 "+s:r?a<r||"长度必须小于 "+r:"无效参数":void 0},equal:function(e,s){var r=i.querySelector(s);return e===r.value||"您输入的密码不一致"}}});var v={bootstrap:{failStyle:{},failHtml:['!<span class="glyphicon glyphicon-remove form-control-feedback"></span>','<small class="help-block"></small>'],failCss:"++has-error has-feedback",passHtml:'<span class="glyphicon glyphicon-ok form-control-feedback"></span>',passCss:"++has-success has-feedback"},semantic:{failStyle:{},failHtml:['!<i class="remove icon"></i>','+<small class="ui red pointing label"></small>'],failCss:"++error",passHtml:'<i class="checkmark icon"></i>'}};return r.setSkin=function(e){r.config(v[e])},r});