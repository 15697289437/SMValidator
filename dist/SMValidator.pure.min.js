/*!
 * SMValidator 1.1.2
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 * Released under the MIT License.
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e,r,t){c?e.attachEvent("on"+r,t):e.addEventListener(r,t)}function r(e){return"checkbox"===e||"radio"===e}function t(e){return"string"==typeof e}function s(e,r){return p.call(e,r)}function n(e,r){var t=this;r||(r={});for(var n=d.length-1;n>=0;n--){var a=d[n];t[a]=s(r,a)?r[a]:v[a]}if(t.fields={},t.rules=r.rules||{},e){t.submit=r.submit;for(var l in r.fields)t.fields[l]=t.parseField(r.fields[l]);t.queryInput(e)}}function a(e,r){if(e)for(var t=e.length-1;t>=0;t--){for(var s=e[t],n=s.target,a=s.className.split(" "),l=n.className.split(" "),i=a.length-1;i>=0;i--){var u=a[i],f=l.indexOf(u);!r&&f>-1?l.splice(f,1):r&&f===-1&&l.push(u)}n.className=l.join(" ")}}function l(e,r,t){if(e)for(var s=e.length-1;s>=0;s--){var n=e[s];n.dom.style.display=r?"":"none",t&&!n.quiet&&(n.dom.innerHTML=t)}}function i(e,r){if(r)for(var t in r)e.style[t]=r[t]}function u(e){var r=e._sm;i(e,r.style),l(r.failHtml,!1),l(r.passHtml,!1),a(r.failCss,!1),a(r.passCss,!1)}function f(e,t){var s=e.type,n=e.name,f=e._sm,o=f.rule,c=!0,p=[],d=1,m="",y="|"===o.token;if(r(s)&&e.form)for(var h=e.form.elements[n],v=h.length-1;v>=0;v--)h[v].checked&&(m+=" ");else if("select-multiple"===s)for(var h=e.children,v=h.length-1;v>=0;v--)h[v].selected&&h[v].value&&(m+=" ");else m=e.value;if(t&&"number"==typeof t.forceFlag)d=t.forceFlag,o.async&&(f.asyncFlag=d,t.asyncMessage&&(f.asyncMessage=t.asyncMessage),2===d&&(c=f.asyncMessage||"no asyncMessage!"));else if(o.async)o.required&&!m?(d=2,c=o.required):"number"==typeof f.asyncFlag?(d=f.asyncFlag,2===d&&(c=f.asyncMessage||"no asyncMessage!")):m?(d=2,c=o.async):d=0;else if(m)for(var v=o.rules.length-1;v>=0;v--){var b=o.rules[v],S=b.rule;if(S instanceof RegExp){if(!S.test(m)){if(c=b.message,d=2,y)break;p.push(c)}}else if(c=b.params?S.apply(null,[m].concat(b.params)):S.call(null,m),c!==!0){if(d=2,y)break;p.push(c)}}else o.required?(d=2,c=o.required,y||p.push(c)):d=0;return y||(d=p.length?2:1),u(e),1===d?(a(f.failCss,!1),a(f.passCss,!0),i(e,o.passStyle),l(f.passHtml,!0),o.pass&&o.pass.call(e)):2===d&&(a(f.passCss,!1),a(f.failCss,!0),i(e,o.failStyle),l(f.failHtml,!0,y?c:p.join("<br/>")),o.fail&&o.fail.call(e,y?c:p)),2===d&&g&&(e.scrollIntoView(),g=!1),c}var o=window.document,c=!o.addEventListener;c?(Array.prototype.indexOf=function(e){for(var r=0,t=this.length;r<t;r++)if(this[r]===e)return r;return-1},Object.defineProperty(Element.prototype,"nextElementSibling",{get:function(){for(var e=this.nextSibling;e&&1!==e.nodeType;)e=e.nextSibling;return e}})):o.addEventListener("input",function(e){var r=e.target;r._sm&&!r._sm.rule.disinput&&f(r)}),e(o,"change",function(e){var t=e.target||e.srcElement;r(t.type)&&t._sm&&!t._sm.rule.manul&&f(t)});var p=Object.prototype.hasOwnProperty,d=["required","async","short","disinput","disblur","focus","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],m=d.slice(3),y=n.prototype;y.queryInput=function(r){for(var t=this,s=[],a=o.querySelectorAll(r),l=a.length-1;l>=0;l--){var i=a[l],u=i.tagName;if("FORM"===u){i.novalidate="novalidate";for(var f=[],c=i.length-1;c>=0;c--)t.bindInput(i[c])&&f.push(i[c]);s=s.concat(f),t.submit&&f.length&&(i._smInputs=f,e(i,"submit",function(e){e.preventDefault();var r=e.target||e.srcElement,s=n.validate(r._smInputs,{locate:!0,short:t.short});t.submit(s,r)}))}else"INPUT"!==u&&"SELECT"!==u&&"TEXTAREA"!==u||t.bindInput(i)&&s.push(i)}return s},y.bindInput=function(t){if(t._sm)return!0;var n=this,a=t.getAttribute("name"),l=t.getAttribute("data-rule"),i=l?this.parseString(l):this.fields[a];if(i){if(t._sm={rule:i,flag:0},!i._isInit){i._isInit=!0,n.handleProperty(i,"required"),n.handleProperty(i,"async"),i.async&&(i.manul=!0);for(var p=m.length-1;p>=0;p--){var d=m[p];s(i,d)||(i[d]=this[d])}n.handleStyle(i,"failStyle"),n.handleStyle(i,"passStyle")}if(r(t.type)){for(var y=o.querySelectorAll('input[name="'+a+'"]'),p=y.length-1;p>=0;p--)y[p]!==t&&(y[p]._sm=t._sm);i.disblur=i.disinput=!0,i.focus=!1}else t.style.border||(t.style.border="1px solid #a9a9a9");return n.recordStyle(t,i.failStyle),n.recordStyle(t,i.passStyle),n.handleHtml(t,"failHtml",i.failHtml),n.handleHtml(t,"passHtml",i.passHtml),n.handleCss(t,"failCss",i.failCss),n.handleCss(t,"passCss",i.passCss),i.manul&&(i.disblur=i.disinput=!0),i.focus&&e(t,"focus",function(e){u(e.target||e.srcElement)}),i.disblur||e(t,"blur",function(e){f(e.target||e.srcElement)}),c&&!i.disinput&&t.attachEvent("onpropertychange",function(e){"value"===e.propertyName&&f(e.srcElement)}),!0}return!1},y.handleProperty=function(e,r){s(e,r)?e[r]===!0&&(e[r]=this[r]):e[r]=!1},y.handleStyle=function(e,r){if(t(e[r]))try{e[r]=JSON.parse(e[r].replace(/'/g,'"'))}catch(t){console.error("error json format: "+e[r])}},y.recordStyle=function(e,r){if(r){e._sm.style||(e._sm.style={});var t=e._sm.style;for(var s in r)t[s]||(t[s]=e.style[s])}},y.handleHtml=function(e,r,s){if(s){e._sm[r]=[],t(s)&&(s=[s]);for(var n=0;n<s.length;n++){var a,l=s[n],i={};if(0===l.indexOf("!")&&(l=l.substring(1),i.quiet=!0),l.indexOf("<")>-1){for(var u=e;0===l.indexOf("+");)l=l.substring(1),u=u.parentNode;var f=o.createElement("div");f.innerHTML=l,a=f.children[0],u.parentNode.insertBefore(a,u.nextElementSibling)}else a=o.querySelector(l);a&&(i.dom=a,a.style.display="none",e._sm[r].push(i))}}},y.handleCss=function(e,r,s){if(s){t(s)&&(s=[s]),e._sm[r]=[];for(var n=s.length-1;n>=0;n--){for(var a=s[n],l=e;0===a.indexOf("+");)a=a.substring(1),l=l.parentNode;e._sm[r].push({target:l,className:a})}}},y.parseRule=function(e,r){var t=e.name,s=this.rules[t]||v.rules[t];s&&(s instanceof Array?r.rules.push({rule:s[0],message:s[1]}):r.rules.push({rule:s,params:e.params}))},y.parseStringFunction=function(e){var r={name:e},t=e.indexOf("(");return t>0&&(r.name=e.substring(0,t),r.params=e.substring(t+1,e.length-1).split(",")),r},y.parseString=function(e){var r={rules:[]},t=e.indexOf("&")>-1?"&":"|",s=e.split(t);r.token=t;for(var n=s.length-1;n>=0;n--){var a=s[n];if(a)if(0===a.indexOf("/")){var l=a.substring(1).split("/");2===l.length?r.rules.push({rule:new RegExp(l[0]),message:l[1]}):3===l.length&&r.rules.push({rule:new RegExp(l[0],"i"),message:l[2]})}else{var i=this.parseStringFunction(a),u=i.name,f=!0;if("!"===u.charAt(0)&&(u=u.substring(1),f=!1),d.indexOf(u)>-1){var o=i.params;o?r[u]="failStyle"===u||"passStyle"===u?o[0]:o:r[u]=f}else this.parseRule(i,r)}}return r},y.parseField=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if(t(e))return this.parseString(e);if("object"==typeof e){if(e.token="|",e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if(t(e.rule)){var r=e.rule;delete e.rule,r.indexOf("&")>-1&&(e.token="&");var s=r.split(e.token);e.rules=[];for(var n=s.length-1;n>=0;n--)s[n]&&this.parseRule(this.parseStringFunction(s[n]),e)}return e}};var h,g,v={async:"not been validated by async",required:"this is required",rules:{}};return n.config=function(e){for(var r=d.length-1;r>=0;r--){var t=d[r];s(e,t)&&(v[t]=e[t])}if(e.rules)for(var a in e.rules)v.rules[a]=e.rules[a];h=new n},n.validate=function(e,r){var s=t(e)?h.queryInput(e):e,n=0,a=0,l=!1;r&&(g=r.locate,l=r.short);for(var i=s.length-1;i>=0;i--){var u=s[i];if(u._sm)if(a++,f(u,r)===!0)n++;else if(l)return!1}return a===n},n.reset=function(e){for(var r=t(e)?h.queryInput(e):e,s=r.length-1;s>=0;s--)u(r[s])},n});