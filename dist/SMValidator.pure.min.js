/*!
 * sm-validator 0.10.2
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 * Released under the MIT License.
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e){e&&e.required&&(delete e.required,console.warn('"required" customized rule is invalid'))}function r(e){return"string"==typeof e}function s(r,s){var t=this;s||(s={});for(var a=o.length-1;a>=0;a--){var n=o[a];t[n]=s.hasOwnProperty(n)?s[n]:m[n]}if(t.fields={},t.rules=s.rules||{},r){e(s.rules),t.submit=s.submit;for(var l in s.fields)t.fields[l]=t.parseField(s.fields[l]);t.queryInput(r)}}function t(e,r){if(e)for(var s=e.length-1;s>=0;s--){for(var t=e[s],a=t.target,n=t.className.split(" "),l=a.className.split(" "),i=n.length-1;i>=0;i--){var u=n[i],f=l.indexOf(u);!r&&f>-1?l.splice(f,1):r&&f===-1&&l.push(u)}a.className=l.join(" ")}}function a(e,r,s){if(e)for(var t=e.length-1;t>=0;t--){var a=e[t];a.dom.style.display=r?"":"none",s&&!a.quiet&&(a.dom.innerText=s)}}function n(e,r){if(r)for(var s in r)e.style[s]=r[s]}function l(e,r){var s=e.type,l=e.name,i=e._sm,u=i.rule,f=!0,o=1,p="";if("checkbox"!==s&&"radio"!==s||!e.form)if("select-multiple"===s)for(var c=e.children,v=c.length-1;v>=0;v--)c[v].selected&&c[v].value&&(p+=" ");else p=e.value;else for(var c=e.form.elements[l],v=c.length-1;v>=0;v--)c[v].checked&&(p+=" ");if(r&&"number"==typeof r.forceFlag)o=r.forceFlag,u.server&&(i.serverFlag=o,r.serverMessage&&(i.serverMessage=r.serverMessage),2===o&&(f=i.serverMessage||"no reason"));else if(u.server)u.required&&!p?(o=2,f=m.requiredMessage):"number"==typeof i.serverFlag?(o=i.serverFlag,2===o&&(f=i.serverMessage||"no reason")):p?(o=2,f=m.noServerMessage):o=0;else if(u.required||p)for(var v=u.rules.length-1;v>=0;v--){var g=u.rules[v],d=g.rule;if(d instanceof RegExp){if(!d.test(p)){f=g.message,o=2;break}}else if(f=g.params?d.apply(null,[p].concat(g.params)):d.call(null,p),f!==!0){o=2;break}}else o=0;return o===i.flag&&i.lastResult===f||(i.lastResult=f,i.flag=o,n(e,i.style),a(i.failHtml,!1),a(i.passHtml,!1),1===o?(t(i.failCss,!1),t(i.passCss,!0),n(e,u.passStyle),a(i.passHtml,!0),u.pass&&u.pass.call(e)):2===o?(t(i.passCss,!1),t(i.failCss,!0),n(e,u.failStyle),a(i.failHtml,!0,f),u.fail&&u.fail.call(e)):(t(i.failCss,!1),t(i.passCss,!1))),2===o&&m._useLocate&&(e.scrollIntoView(),m._useLocate=!1),f}var i=window.document,u=i.addEventListener?i.addEventListener:i.attachEvent,f="oninput"in i?"input":"propertychange";u.call(i,f,function(e){var r=e.target;!r._sm||r._sm.rule.manul||r._sm.rule.blur||l(r)}),u.call(i,"change",function(e){var r=e.target;r._sm&&!r._sm.rule.manul&&r._sm.rule.blur&&l(r)});var o=["server","blur","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],p=s.prototype;p.queryInput=function(e){for(var r=this,t=[],a=i.querySelectorAll(e),n=a.length-1;n>=0;n--){var l=a[n],f=l.tagName;if("FORM"===f){l.novalidate="novalidate";for(var o=[],p=l.length-1;p>=0;p--)r.bindInput(l[p])&&o.push(l[p]);t=t.concat(o),r.submit&&o.length&&(l._smInputs=o,u.call(l,"submit",function(e){e.preventDefault();var t=s.validate(e.target._smInputs,{locate:!0});r.submit(t,e.target)}))}else"INPUT"!==f&&"SELECT"!==f&&"TEXTAREA"!==f||r.bindInput(l)&&t.push(l)}return t},p.bindInput=function(e){function s(e,s){if(r(e[s]))try{e[s]=JSON.parse(e[s].replace(/'/g,'"'))}catch(r){console.error("error json format: "+e[s])}}function t(e,r){if(r){e._sm.style||(e._sm.style={});var s=e._sm.style;for(var t in r)s[t]||(s[t]=e.style[t])}}function a(e,s,t){if(t){e._sm[s]=[],r(t)&&(t=[t]);for(var a=0;a<t.length;a++){var n,l=t[a],u={};if(0===l.indexOf("!")&&(l=l.substring(1),u.quiet=!0),l.indexOf("<")>-1){for(var f=e;0===l.indexOf("+");)l=l.substring(1),f=f.parentNode;var o=i.createElement("div");o.innerHTML=l,n=o.childNodes[0],f.parentNode.insertBefore(n,f.nextElementSibling)}else n=i.querySelector(l);n&&(u.dom=n,n.style.display="none",e._sm[s].push(u))}}}function n(e,s,t){if(t){r(t)&&(t=[t]),e._sm[s]=[];for(var a=t.length-1;a>=0;a--){for(var n=t[a],l=e;0===n.indexOf("+");)n=n.substring(1),l=l.parentNode;e._sm[s].push({target:l,className:n})}}}if(e._sm)return!0;var l=e.getAttribute("name"),u=e.getAttribute("data-rule"),f=u?this.parseString(u):this.fields[l];if(f){if(e._sm={rule:f,flag:0},"checkbox"===e.type||"radio"===e.type){for(var p=i.querySelectorAll('input[name="'+l+'"]'),c=p.length-1;c>=0;c--)p[c]!==e&&(p[c]._sm=e._sm);f.blur=!0}if(!f._isInit){f._isInit=!0;for(var c=o.length-1;c>=0;c--){var m=o[c];f.hasOwnProperty(m)||(f[m]=this[m])}f.server&&(f.manul=!0),s(f,"failStyle"),s(f,"passStyle")}return t(e,f.failStyle),t(e,f.passStyle),a(e,"failHtml",f.failHtml),a(e,"passHtml",f.passHtml),n(e,"failCss",f.failCss),n(e,"passCss",f.passCss),!0}return!1},p.parseRule=function(e,r){var s=e.name,t=this.rules[s]||m.rules[s];t&&(t instanceof Array?r.rules.push({rule:t[0],message:t[1]}):r.rules.push({rule:t,params:e.params}),"required"===s&&(r.required=!0))},p.parseStringFunction=function(e){var r={name:e},s=e.indexOf("(");return s>0&&(r.name=e.substring(0,s),r.params=e.substring(s+1,e.length-1).split(",")),r},p.parseString=function(e){for(var r={rules:[]},s=e.split(";"),t=s.length-1;t>=0;t--){var a=s[t];if(a)if(0===a.indexOf("/")){var n=a.substring(1).split("/");2===n.length?r.rules.push({rule:new RegExp(n[0]),message:n[1]}):3===n.length&&r.rules.push({rule:new RegExp(n[0],"i"),message:n[2]})}else{var l=this.parseStringFunction(a);if(o.indexOf(l.name)>-1){var i=l.name;"blur"===i||"manul"===i||"server"===i?r[i]=!0:"failStyle"===i||"passStyle"===i?r[i]=l.params[0]:r[i]=l.params}else this.parseRule(l,r)}}return r},p.parseField=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if(r(e))return this.parseString(e);if("object"==typeof e){if(e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if(r(e.rule)){var s=e.rule.split(";");e.rules=[];for(var t=s.length-1;t>=0;t--)""!==s[t]&&this.parseRule(this.parseStringFunction(s[t]),e);delete e.rule}return e}};var c,m={noServerMessage:"not been validated by server",requiredMessage:"this is required",rules:{required:function(e){return!!e||m.requiredMessage}}};return s.config=function(r){for(var t=o.concat(["noServerMessage","requiredMessage"]),a=t.length-1;a>=0;a--){var n=t[a];r.hasOwnProperty(n)&&(m[n]=r[n])}if(r.rules){e(r.rules);for(var l in r.rules)m.rules[l]=r.rules[l]}c=new s},s.validate=function(e,s){var t=r(e)?c.queryInput(e):e,a=0,n=0;s&&s.locate&&(m._useLocate=!0);for(var i=t.length-1;i>=0;i--){var u=t[i];u._sm&&(n++,l(u,s)===!0&&a++)}return n===a},s.reset=function(e){s.validate(e,{forceFlag:0})},s});