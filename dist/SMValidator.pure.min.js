/*!
 * SMValidator 1.1.0
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 * Released under the MIT License.
 */!function(e,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):e.SMValidator=s()}(this,function(){"use strict";function e(e){return"checkbox"===e||"radio"===e}function s(e){return"string"==typeof e}function r(e,s){return p.call(e,s)}function t(e,s){var t=this;s||(s={});for(var n=d.length-1;n>=0;n--){var a=d[n];t[a]=r(s,a)?s[a]:v[a]}if(t.fields={},t.rules=s.rules||{},e){t.submit=s.submit;for(var l in s.fields)t.fields[l]=t.parseField(s.fields[l]);t.queryInput(e)}}function n(e,s){if(e)for(var r=e.length-1;r>=0;r--){for(var t=e[r],n=t.target,a=t.className.split(" "),l=n.className.split(" "),i=a.length-1;i>=0;i--){var u=a[i],f=l.indexOf(u);!s&&f>-1?l.splice(f,1):s&&f===-1&&l.push(u)}n.className=l.join(" ")}}function a(e,s,r){if(e)for(var t=e.length-1;t>=0;t--){var n=e[t];n.dom.style.display=s?"":"none",r&&!n.quiet&&(n.dom.innerHTML=r)}}function l(e,s){if(s)for(var r in s)e.style[r]=s[r]}function i(e){var s=e._sm;l(e,s.style),a(s.failHtml,!1),a(s.passHtml,!1),n(s.failCss,!1),n(s.passCss,!1)}function u(s,r){var t=s.type,u=s.name,f=s._sm,o=f.rule,c=!0,p=[],d=1,m="",h="|"===o.token;if(e(t)&&s.form)for(var g=s.form.elements[u],v=g.length-1;v>=0;v--)g[v].checked&&(m+=" ");else if("select-multiple"===t)for(var g=s.children,v=g.length-1;v>=0;v--)g[v].selected&&g[v].value&&(m+=" ");else m=s.value;if(r&&"number"==typeof r.forceFlag)d=r.forceFlag,o.async&&(f.asyncFlag=d,r.asyncMessage&&(f.asyncMessage=r.asyncMessage),2===d&&(c=f.asyncMessage||"no asyncMessage!"));else if(o.async)o.required&&!m?(d=2,c=o.required):"number"==typeof f.asyncFlag?(d=f.asyncFlag,2===d&&(c=f.asyncMessage||"no asyncMessage!")):m?(d=2,c=o.async):d=0;else if(m)for(var v=o.rules.length-1;v>=0;v--){var b=o.rules[v],S=b.rule;if(S instanceof RegExp){if(!S.test(m)){if(c=b.message,d=2,h)break;p.push(c)}}else if(c=b.params?S.apply(null,[m].concat(b.params)):S.call(null,m),c!==!0){if(d=2,h)break;p.push(c)}}else o.required?(d=2,c=o.required,h||p.push(c)):d=0;return h||(d=p.length?2:1),i(s),1===d?(n(f.failCss,!1),n(f.passCss,!0),l(s,o.passStyle),a(f.passHtml,!0),o.pass&&o.pass.call(s)):2===d&&(n(f.passCss,!1),n(f.failCss,!0),l(s,o.failStyle),a(f.failHtml,!0,h?c:p.join("<br/>")),o.fail&&o.fail.call(s,h?c:p)),2===d&&y&&(s.scrollIntoView(),y=!1),c}var f=window.document,o=f.addEventListener?f.addEventListener:f.attachEvent,c="oninput"in f?"input":"propertychange";o.call(f,c,function(e){var s=e.target;!s._sm||s._sm.rule.disinput||s._sm.rule.manul||u(s)}),o.call(f,"change",function(s){var r=s.target;e(r.type)&&r._sm&&!r._sm.rule.manul&&u(r)});var p=Object.prototype.hasOwnProperty,d=["required","async","short","disinput","disblur","focus","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],m=d.slice(3),h=t.prototype;h.queryInput=function(e){for(var s=this,r=[],n=f.querySelectorAll(e),a=n.length-1;a>=0;a--){var l=n[a],i=l.tagName;if("FORM"===i){l.novalidate="novalidate";for(var u=[],c=l.length-1;c>=0;c--)s.bindInput(l[c])&&u.push(l[c]);r=r.concat(u),s.submit&&u.length&&(l._smInputs=u,o.call(l,"submit",function(e){e.preventDefault();var r=t.validate(e.target._smInputs,{locate:!0,short:s.short});s.submit(r,e.target)}))}else"INPUT"!==i&&"SELECT"!==i&&"TEXTAREA"!==i||s.bindInput(l)&&r.push(l)}return r},h.bindInput=function(s){if(s._sm)return!0;var t=this,n=s.getAttribute("name"),a=s.getAttribute("data-rule"),l=a?this.parseString(a):this.fields[n];if(l){if(s._sm={rule:l,flag:0},!l._isInit){l._isInit=!0,t.handleProperty(l,"required"),t.handleProperty(l,"async"),l.async&&(l.manul=!0);for(var c=m.length-1;c>=0;c--){var p=m[c];r(l,p)||(l[p]=this[p])}t.handleStyle(l,"failStyle"),t.handleStyle(l,"passStyle")}if(e(s.type)){for(var d=f.querySelectorAll('input[name="'+n+'"]'),c=d.length-1;c>=0;c--)d[c]!==s&&(d[c]._sm=s._sm);l.disblur=l.disinput=!0,l.focus=!1}return t.recordStyle(s,l.failStyle),t.recordStyle(s,l.passStyle),t.handleHtml(s,"failHtml",l.failHtml),t.handleHtml(s,"passHtml",l.passHtml),t.handleCss(s,"failCss",l.failCss),t.handleCss(s,"passCss",l.passCss),l.focus&&o.call(s,"focus",function(e){i(e.target)}),l.disblur||o.call(s,"blur",function(e){u(e.target)}),!0}return!1},h.handleProperty=function(e,s){r(e,s)?e[s]===!0&&(e[s]=this[s]):e[s]=!1},h.handleStyle=function(e,r){if(s(e[r]))try{e[r]=JSON.parse(e[r].replace(/'/g,'"'))}catch(s){console.error("error json format: "+e[r])}},h.recordStyle=function(e,s){if(s){e._sm.style||(e._sm.style={});var r=e._sm.style;for(var t in s)r[t]||(r[t]=e.style[t])}},h.handleHtml=function(e,r,t){if(t){e._sm[r]=[],s(t)&&(t=[t]);for(var n=0;n<t.length;n++){var a,l=t[n],i={};if(0===l.indexOf("!")&&(l=l.substring(1),i.quiet=!0),l.indexOf("<")>-1){for(var u=e;0===l.indexOf("+");)l=l.substring(1),u=u.parentNode;var o=f.createElement("div");o.innerHTML=l,a=o.children[0],u.parentNode.insertBefore(a,u.nextElementSibling)}else a=f.querySelector(l);a&&(i.dom=a,a.style.display="none",e._sm[r].push(i))}}},h.handleCss=function(e,r,t){if(t){s(t)&&(t=[t]),e._sm[r]=[];for(var n=t.length-1;n>=0;n--){for(var a=t[n],l=e;0===a.indexOf("+");)a=a.substring(1),l=l.parentNode;e._sm[r].push({target:l,className:a})}}},h.parseRule=function(e,s){var r=e.name,t=this.rules[r]||v.rules[r];t&&(t instanceof Array?s.rules.push({rule:t[0],message:t[1]}):s.rules.push({rule:t,params:e.params}))},h.parseStringFunction=function(e){var s={name:e},r=e.indexOf("(");return r>0&&(s.name=e.substring(0,r),s.params=e.substring(r+1,e.length-1).split(",")),s},h.parseString=function(e){var s={rules:[]},r=e.indexOf("&")>-1?"&":"|",t=e.split(r);s.token=r;for(var n=t.length-1;n>=0;n--){var a=t[n];if(a)if(0===a.indexOf("/")){var l=a.substring(1).split("/");2===l.length?s.rules.push({rule:new RegExp(l[0]),message:l[1]}):3===l.length&&s.rules.push({rule:new RegExp(l[0],"i"),message:l[2]})}else{var i=this.parseStringFunction(a),u=i.name,f=!0;if("!"===u.charAt(0)&&(u=u.substring(1),f=!1),d.indexOf(u)>-1){var o=i.params;o?s[u]="failStyle"===u||"passStyle"===u?o[0]:o:s[u]=f}else this.parseRule(i,s)}}return s},h.parseField=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if(s(e))return this.parseString(e);if("object"==typeof e){if(e.token="|",e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if(s(e.rule)){var r=e.rule;delete e.rule,r.indexOf("&")>-1&&(e.token="&");var t=r.split(e.token);e.rules=[];for(var n=t.length-1;n>=0;n--)t[n]&&this.parseRule(this.parseStringFunction(t[n]),e)}return e}};var g,y,v={async:"not been validated by async",required:"this is required",rules:{}};return t.config=function(e){for(var s=d.length-1;s>=0;s--){var n=d[s];r(e,n)&&(v[n]=e[n])}if(e.rules)for(var a in e.rules)v.rules[a]=e.rules[a];g=new t},t.validate=function(e,r){var t=s(e)?g.queryInput(e):e,n=0,a=0,l=!1;r&&(y=r.locate,l=r.short);for(var i=t.length-1;i>=0;i--){var f=t[i];if(f._sm)if(a++,u(f,r)===!0)n++;else if(l)return!1}return a===n},t.reset=function(e){for(var r=s(e)?g.queryInput(e):e,t=r.length-1;t>=0;t--)i(r[t])},t});