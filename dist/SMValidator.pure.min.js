/*!
 * sm-validator 0.11.2
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 * Released under the MIT License.
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e){return"string"==typeof e}function r(e,r){return o.call(e,r)}function s(e,s){var t=this;s||(s={});for(var a=p.length-1;a>=0;a--){var l=p[a];t[l]=r(s,l)?s[l]:v[l]}if(t.fields={},t.rules=s.rules||{},e){t.submit=s.submit;for(var n in s.fields)t.fields[n]=t.parseField(s.fields[n]);t.queryInput(e)}}function t(e,r){if(e)for(var s=e.length-1;s>=0;s--){for(var t=e[s],a=t.target,l=t.className.split(" "),n=a.className.split(" "),i=l.length-1;i>=0;i--){var u=l[i],f=n.indexOf(u);!r&&f>-1?n.splice(f,1):r&&f===-1&&n.push(u)}a.className=n.join(" ")}}function a(e,r,s){if(e)for(var t=e.length-1;t>=0;t--){var a=e[t];a.dom.style.display=r?"":"none",s&&!a.quiet&&(a.dom.innerText=s)}}function l(e,r){if(r)for(var s in r)e.style[s]=r[s]}function n(e,r){var s=e.type,n=e.name,i=e._sm,u=i.rule,f=!0,o=1,p="";if("checkbox"!==s&&"radio"!==s||!e.form)if("select-multiple"===s)for(var c=e.children,m=c.length-1;m>=0;m--)c[m].selected&&c[m].value&&(p+=" ");else p=e.value;else for(var c=e.form.elements[n],m=c.length-1;m>=0;m--)c[m].checked&&(p+=" ");if(r&&"number"==typeof r.forceFlag)o=r.forceFlag,u.server&&(i.serverFlag=o,r.serverMessage&&(i.serverMessage=r.serverMessage),2===o&&(f=i.serverMessage||"no serverMessage!"));else if(u.server)u.required&&!p?(o=2,f=u.required):"number"==typeof i.serverFlag?(o=i.serverFlag,2===o&&(f=i.serverMessage||"no serverMessage!")):p?(o=2,f=u.server):o=0;else if(p)for(var m=u.rules.length-1;m>=0;m--){var g=u.rules[m],d=g.rule;if(d instanceof RegExp){if(!d.test(p)){f=g.message,o=2;break}}else if(f=g.params?d.apply(null,[p].concat(g.params)):d.call(null,p),f!==!0){o=2;break}}else u.required?(o=2,f=u.required):o=0;return o===i.flag&&i.lastResult===f||(i.lastResult=f,i.flag=o,l(e,i.style),a(i.failHtml,!1),a(i.passHtml,!1),1===o?(t(i.failCss,!1),t(i.passCss,!0),l(e,u.passStyle),a(i.passHtml,!0),u.pass&&u.pass.call(e)):2===o?(t(i.passCss,!1),t(i.failCss,!0),l(e,u.failStyle),a(i.failHtml,!0,f),u.fail&&u.fail.call(e)):(t(i.failCss,!1),t(i.passCss,!1))),2===o&&v._useLocate&&(e.scrollIntoView(),v._useLocate=!1),f}var i=window.document,u=i.addEventListener?i.addEventListener:i.attachEvent,f="oninput"in i?"input":"propertychange";u.call(i,f,function(e){var r=e.target;!r._sm||r._sm.rule.manul||r._sm.rule.blur||n(r)}),u.call(i,"change",function(e){var r=e.target;r._sm&&!r._sm.rule.manul&&r._sm.rule.blur&&n(r)});var o=Object.prototype.hasOwnProperty,p=["required","server","blur","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],c=s.prototype;c.queryInput=function(e){for(var r=this,t=[],a=i.querySelectorAll(e),l=a.length-1;l>=0;l--){var n=a[l],f=n.tagName;if("FORM"===f){n.novalidate="novalidate";for(var o=[],p=n.length-1;p>=0;p--)r.bindInput(n[p])&&o.push(n[p]);t=t.concat(o),r.submit&&o.length&&(n._smInputs=o,u.call(n,"submit",function(e){e.preventDefault();var t=s.validate(e.target._smInputs,{locate:!0});r.submit(t,e.target)}))}else"INPUT"!==f&&"SELECT"!==f&&"TEXTAREA"!==f||r.bindInput(n)&&t.push(n)}return t},c.bindInput=function(s){function t(e,s){r(e,s)?e[s]===!0&&(e[s]=this[s]):e[s]=!1}function a(r,s){if(e(r[s]))try{r[s]=JSON.parse(r[s].replace(/'/g,'"'))}catch(e){console.error("error json format: "+r[s])}}function l(e,r){if(r){e._sm.style||(e._sm.style={});var s=e._sm.style;for(var t in r)s[t]||(s[t]=e.style[t])}}function n(r,s,t){if(t){r._sm[s]=[],e(t)&&(t=[t]);for(var a=0;a<t.length;a++){var l,n=t[a],u={};if(0===n.indexOf("!")&&(n=n.substring(1),u.quiet=!0),n.indexOf("<")>-1){for(var f=r;0===n.indexOf("+");)n=n.substring(1),f=f.parentNode;var o=i.createElement("div");o.innerHTML=n,l=o.children[0],f.parentNode.insertBefore(l,f.nextElementSibling)}else l=i.querySelector(n);l&&(u.dom=l,l.style.display="none",r._sm[s].push(u))}}}function u(r,s,t){if(t){e(t)&&(t=[t]),r._sm[s]=[];for(var a=t.length-1;a>=0;a--){for(var l=t[a],n=r;0===l.indexOf("+");)l=l.substring(1),n=n.parentNode;r._sm[s].push({target:n,className:l})}}}if(s._sm)return!0;var f=s.getAttribute("name"),o=s.getAttribute("data-rule"),c=o?this.parseString(o):this.fields[f];if(c){if(s._sm={rule:c,flag:0},"checkbox"===s.type||"radio"===s.type){for(var m=i.querySelectorAll('input[name="'+f+'"]'),v=m.length-1;v>=0;v--)m[v]!==s&&(m[v]._sm=s._sm);c.blur=!0}if(!c._isInit){c._isInit=!0,t.call(this,c,"required"),t.call(this,c,"server"),c.server&&(c.manul=!0);for(var v=p.length-1;v>=0;v--){var g=p[v];r(c,g)||(c[g]=this[g])}a(c,"failStyle"),a(c,"passStyle")}return l(s,c.failStyle),l(s,c.passStyle),n(s,"failHtml",c.failHtml),n(s,"passHtml",c.passHtml),u(s,"failCss",c.failCss),u(s,"passCss",c.passCss),!0}return!1},c.parseRule=function(e,r){var s=e.name,t=this.rules[s]||v.rules[s];t&&(t instanceof Array?r.rules.push({rule:t[0],message:t[1]}):r.rules.push({rule:t,params:e.params}))},c.parseStringFunction=function(e){var r={name:e},s=e.indexOf("(");return s>0&&(r.name=e.substring(0,s),r.params=e.substring(s+1,e.length-1).split(",")),r},c.parseString=function(e){for(var r={rules:[]},s=e.split(";"),t=s.length-1;t>=0;t--){var a=s[t];if(a)if(0===a.indexOf("/")){var l=a.substring(1).split("/");2===l.length?r.rules.push({rule:new RegExp(l[0]),message:l[1]}):3===l.length&&r.rules.push({rule:new RegExp(l[0],"i"),message:l[2]})}else{var n=this.parseStringFunction(a);if(p.indexOf(n.name)>-1){var i=n.name;"failStyle"===i||"passStyle"===i?r[i]=n.params[0]:r[i]=n.params||!0}else this.parseRule(n,r)}}return r},c.parseField=function(r){if(r instanceof Array)return{rules:[{rule:r[0],message:r[1]}]};if(r instanceof Function)return{rules:[{rule:r}]};if(e(r))return this.parseString(r);if("object"==typeof r){if(r.rule instanceof Array)r.rules=[{rule:r.rule[0],message:r.rule[1]}];else if(r.rule instanceof Function)r.rules=[{rule:r.rule}];else if(e(r.rule)){var s=r.rule.split(";");r.rules=[];for(var t=s.length-1;t>=0;t--)s[t]&&this.parseRule(this.parseStringFunction(s[t]),r);delete r.rule}return r}};var m,v={server:"not been validated by server",required:"this is required",rules:{}};return s.config=function(e){for(var t=p.length-1;t>=0;t--){var a=p[t];r(e,a)&&(v[a]=e[a])}if(e.rules)for(var l in e.rules)v.rules[l]=e.rules[l];m=new s},s.validate=function(r,s){var t=e(r)?m.queryInput(r):r,a=0,l=0;s&&s.locate&&(v._useLocate=!0);for(var i=t.length-1;i>=0;i--){var u=t[i];u._sm&&(l++,n(u,s)===!0&&a++)}return l===a},s.reset=function(e){s.validate(e,{forceFlag:0})},s});