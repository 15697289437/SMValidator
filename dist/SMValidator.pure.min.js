/*!
 * SMValidator.js 0.9.4
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e){e&&e.required&&(delete e.required,console.warn('"required" customized rule is invalid'))}function r(r,s){if(r){var t=this;s||(s={});for(var a=f.length-1;a>=0;a--){var l=f[a];t[l]=s[l]||p[l]}e(s.rules),t.rules=s.rules||{},t.submit=s.submit,t.fields={};for(var n in s.fields)t.fields[n]=t.parseField(s.fields[n]);t.queryInput(r)}}function s(e,r){if(e)for(var s=e.length-1;s>=0;s--){var t=e[s],a=t.target,l=t.className,n=a.className.split(" "),i=n.indexOf(l);!r&&i>-1?(n.splice(i,1),a.className=n.join(" ")):r&&i===-1&&(a.className+=a.className?" "+l:l)}}function t(e,r){if(e)for(var s=e.length-1;s>=0;s--)e[s].style.display=r?"":"none"}function a(e,r){if(r)for(var s in r)e.style[s]=r[s]}function l(e,r){var l=e._sm,n=l.rule,i=!0,u=1;if(r&&"number"==typeof r.forceFlag)u=r.forceFlag,n.server&&(l.serverFlag=u,r.serverMessage&&(l.serverMessage=r.serverMessage),2===u&&(l.ruleIndex=-2,i=l.serverMessage||"no reason"));else if(n.server)n.required&&!e.value?(u=2,l.ruleIndex=-1,i=p.requiredMessage):"number"==typeof l.serverFlag?(u=l.serverFlag,2===u&&(l.ruleIndex=-2,i=l.serverMessage||"no reason")):e.value?(u=2,l.ruleIndex=-3,i=p.noServerMessage):u=0;else if(n.required||""!==e.value)for(var f=n.rules.length-1;f>=0;f--){var o=n.rules[f],c=o.rule;if(c instanceof RegExp){if(!c.test(e.value)){i=o.message,l.ruleIndex=f,u=2;break}}else if(i=o.params?c.apply(null,[e.value].concat(o.params)):c.call(null,e.value),i!==!0){l.ruleIndex=f,u=2;break}}else u=0;return u===l.flag&&l.ruleIndex===l.lastRuleIndex||(l.lastRuleIndex=l.ruleIndex,l.flag=u,a(e,l.style),t(l.failHtml,!1),t(l.passHtml,!1),1===u?(s(l.failCss,!1),s(l.passCss,!0),a(e,n.passStyle),t(l.passHtml,!0),n.pass&&n.pass.call(e)):2===u?(s(l.passCss,!1),s(l.failCss,!0),a(e,n.failStyle),t(l.failHtml,!0),l.failHtml&&!l._quiet&&(l.failHtml[0].innerText=i),n.fail&&n.fail.call(e)):(s(l.failCss,!1),s(l.passCss,!1))),2===u&&p._useLocate&&(e.scrollIntoView(),p._useLocate=!1),i}var n=window.document,i=n.addEventListener?n.addEventListener:n.attachEvent,u="oninput"in n?"input":"propertychange";i.call(n,u,function(e){var r=e.target;!r._sm||r._sm.rule.manul||r._sm.rule.blur||l(r)}),i.call(n,"change",function(e){var r=e.target;r._sm&&!r._sm.rule.manul&&l(r)});var f=["server","blur","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],o=r.prototype;o.queryInput=function(e){for(var s=this,t=[],a=n.querySelectorAll(e),l=a.length-1;l>=0;l--){var u=a[l];if("FORM"===u.tagName){u.novalidate="novalidate";for(var f=[],o=u.length-1;o>=0;o--)s.bindInput(u[o])&&f.push(u[o]);t=t.concat(f),s.submit&&f.length&&(u._smInputs=f,i.call(u,"submit",function(e){e.preventDefault();var t=r.validate(e.target._smInputs,{locate:!0});s.submit(t,e.target)}))}else"INPUT"===u.tagName&&s.bindInput(u)&&t.push(u)}return t},o.bindInput=function(e){function r(e,r){if("string"==typeof e[r])try{e[r]=JSON.parse(e[r].replace(/'/g,'"'))}catch(s){console.error("error json format: "+e[r])}}function s(e,r){if(r){e._sm.style||(e._sm.style={});var s=e._sm.style;for(var t in r)s[t]||(s[t]=e.style[t])}}function t(e,r,s){if(s){"string"==typeof s&&(s=[s]),e._sm[r]=[];for(var t=0;t<s.length;t++){var a,l=s[t];if(0===t&&0===l.indexOf("!")&&(l=l.substring(1),e._sm._quiet=!0),0===l.indexOf("<")){var i=n.createElement("div");i.innerHTML=l,a=i.childNodes[0],e.parentNode.insertBefore(a,e.nextElementSibling)}else a=n.querySelector(l);a&&(a.style.display="none",e._sm[r].push(a))}}}function a(e,r,s){if(s){"string"==typeof s&&(s=[s]),e._sm[r]=[];for(var t=s.length-1;t>=0;t--){for(var a=s[t],l=e;0===a.indexOf("+");)a=a.substring(1),l=l.parentNode;e._sm[r].push({target:l,className:a})}}}if(e._sm)return!0;var l=e.getAttribute("name"),i=e.getAttribute("data-rule"),u=i?this.parseString(i):this.fields[l];if(u){if(e._sm={rule:u,flag:0},!u._isInit){u._isInit=!0;for(var o=f.length-1;o>=0;o--){var p=f[o];u[p]||(u[p]=this[p])}u.server&&(u.manul=!0),r(u,"failStyle"),r(u,"passStyle")}return s(e,u.failStyle),s(e,u.passStyle),t(e,"failHtml",u.failHtml),t(e,"passHtml",u.passHtml),a(e,"failCss",u.failCss),a(e,"passCss",u.passCss),!0}return!1},o.parseRule=function(e,r){var s=e.name,t=this.rules[s]||p.rules[s];t&&(t instanceof Array?r.rules.push({rule:t[0],message:t[1]}):r.rules.push({rule:t,params:e.params}),r.required="required"===s)},o.parseStringFunction=function(e){var r={name:e},s=e.indexOf("(");return s>0&&(r.name=e.substring(0,s),r.params=e.substring(s+1,e.length-1).split(",")),r},o.parseString=function(e){for(var r={rules:[]},s=e.split(";"),t=s.length-1;t>=0;t--){var a=s[t];if(""!==a)if(0===a.indexOf("/")){var l=a.substring(1).split("/");2===l.length?r.rules.push({rule:new RegExp(l[0]),message:l[1]}):3===l.length&&r.rules.push({rule:new RegExp(l[0],"i"),message:l[2]})}else{var n=this.parseStringFunction(a);if(f.indexOf(n.name)>-1){var i=n.name;"blur"===i||"manul"===i||"server"===i?r[i]=!0:"failStyle"===i||"passStyle"===i?r[i]=n.params[0]:r[i]=n.params}else this.parseRule(n,r)}}return r},o.parseField=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if("string"==typeof e)return this.parseString(e);if("object"==typeof e){if(e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if("string"==typeof e.rule){var r=e.rule.split(";");e.rules=[];for(var s=r.length-1;s>=0;s--)""!==r[s]&&this.parseRule(this.parseStringFunction(r[s]),e);delete e.rule}return e}};var p={noServerMessage:"not been validated by server",requiredMessage:"this is required",rules:{required:function(e){return!!e||p.requiredMessage}}};r.config=function(r){for(var s=f.concat(["noServerMessage","requiredMessage"]),t=s.length-1;t>=0;t--){var a=s[t];r[a]&&(p[a]=r[a])}if(r.rules){e(r.rules);for(var l in r.rules)p.rules[l]=r.rules[l]}};var c=new r;return c.rules=c.fields={},r.validate=function(e,r){var s="string"==typeof e?c.queryInput(e):e,t=0,a=0;r&&r.locate&&(p._useLocate=!0);for(var n=s.length-1;n>=0;n--){var i=s[n];i._sm&&(a++,l(i,r)===!0&&t++)}return a===t},r.reset=function(e){r.validate(e,{forceFlag:0})},r});