/*!
 * sm-validator 0.15.3
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 * Released under the MIT License.
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e){return"string"==typeof e}function r(e,r){return p.call(e,r)}function s(e,s){var t=this;s||(s={});for(var n=c.length-1;n>=0;n--){var l=c[n];t[l]=r(s,l)?s[l]:g[l]}if(t.fields={},t.rules=s.rules||{},e){t.submit=s.submit;for(var a in s.fields)t.fields[a]=t.parseField(s.fields[a]);t.queryInput(e)}}function t(e,r){if(e)for(var s=e.length-1;s>=0;s--){for(var t=e[s],n=t.target,l=t.className.split(" "),a=n.className.split(" "),i=l.length-1;i>=0;i--){var u=l[i],f=a.indexOf(u);!r&&f>-1?a.splice(f,1):r&&f===-1&&a.push(u)}n.className=a.join(" ")}}function n(e,r,s){if(e)for(var t=e.length-1;t>=0;t--){var n=e[t];n.dom.style.display=r?"":"none",s&&!n.quiet&&(n.dom.innerHTML=s)}}function l(e,r){if(r)for(var s in r)e.style[s]=r[s]}function a(e){var r=e._sm;l(e,r.style),n(r.failHtml,!1),n(r.passHtml,!1),t(r.failCss,!1),t(r.passCss,!1)}function i(e,r){var s=e.type,i=e.name,u=e._sm,f=u.rule,o=!0,p=[],c=1,d="",m="|"===f.token;if("checkbox"!==s&&"radio"!==s||!e.form)if("select-multiple"===s)for(var v=e.children,g=v.length-1;g>=0;g--)v[g].selected&&v[g].value&&(d+=" ");else d=e.value;else for(var v=e.form.elements[i],g=v.length-1;g>=0;g--)v[g].checked&&(d+=" ");if(r&&"number"==typeof r.forceFlag)c=r.forceFlag,f.server&&(u.serverFlag=c,r.serverMessage&&(u.serverMessage=r.serverMessage),2===c&&(o=u.serverMessage||"no serverMessage!"));else if(f.server)f.required&&!d?(c=2,o=f.required):"number"==typeof u.serverFlag?(c=u.serverFlag,2===c&&(o=u.serverMessage||"no serverMessage!")):d?(c=2,o=f.server):c=0;else if(d)for(var g=f.rules.length-1;g>=0;g--){var y=f.rules[g],b=y.rule;if(b instanceof RegExp){if(!b.test(d)){if(o=y.message,c=2,m)break;p.push(o)}}else if(o=y.params?b.apply(null,[d].concat(y.params)):b.call(null,d),o!==!0){if(c=2,m)break;p.push(o)}}else f.required?(c=2,o=f.required,m||p.push(o)):c=0;return m||(c=p.length?2:1),a(e),1===c?(t(u.failCss,!1),t(u.passCss,!0),l(e,f.passStyle),n(u.passHtml,!0),f.pass&&f.pass.call(e)):2===c&&(t(u.passCss,!1),t(u.failCss,!0),l(e,f.failStyle),n(u.failHtml,!0,m?o:p.join("<br/>")),f.fail&&f.fail.call(e,m?o:p)),2===c&&h&&(e.scrollIntoView(),h=!1),o}var u=window.document,f=u.addEventListener?u.addEventListener:u.attachEvent,o="oninput"in u?"input":"propertychange";f.call(u,o,function(e){var r=e.target;!r._sm||r._sm.rule.disinput||r._sm.rule.manul||i(r)}),f.call(u,"change",function(e){var r=e.target;"checkbox"!==r.type&&"radio"!==r.type||r._sm&&!r._sm.rule.manul&&i(r)});var p=Object.prototype.hasOwnProperty,c=["required","server","short","disinput","disblur","focus","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],d=c.slice(3),m=s.prototype;m.queryInput=function(e){for(var r=this,t=[],n=u.querySelectorAll(e),l=n.length-1;l>=0;l--){var a=n[l],i=a.tagName;if("FORM"===i){a.novalidate="novalidate";for(var o=[],p=a.length-1;p>=0;p--)r.bindInput(a[p])&&o.push(a[p]);t=t.concat(o),r.submit&&o.length&&(a._smInputs=o,f.call(a,"submit",function(e){e.preventDefault();var t=s.validate(e.target._smInputs,{locate:!0,short:r.short});r.submit(t,e.target)}))}else"INPUT"!==i&&"SELECT"!==i&&"TEXTAREA"!==i||r.bindInput(a)&&t.push(a)}return t},m.bindInput=function(e){if(e._sm)return!0;var s=this,t=e.getAttribute("name"),n=e.getAttribute("data-rule"),l=n?this.parseString(n):this.fields[t];if(l){if(e._sm={rule:l,flag:0},!l._isInit){l._isInit=!0,s.handleProperty(l,"required"),s.handleProperty(l,"server"),l.server&&(l.manul=!0);for(var o=d.length-1;o>=0;o--){var p=d[o];r(l,p)||(l[p]=this[p])}s.handleStyle(l,"failStyle"),s.handleStyle(l,"passStyle")}if("checkbox"===e.type||"radio"===e.type){for(var c=u.querySelectorAll('input[name="'+t+'"]'),o=c.length-1;o>=0;o--)c[o]!==e&&(c[o]._sm=e._sm);l.disblur=l.disinput=!0,l.focus=!1}return s.recordStyle(e,l.failStyle),s.recordStyle(e,l.passStyle),s.handleHtml(e,"failHtml",l.failHtml),s.handleHtml(e,"passHtml",l.passHtml),s.handleCss(e,"failCss",l.failCss),s.handleCss(e,"passCss",l.passCss),l.focus&&f.call(e,"focus",function(e){a(e.target)}),l.disblur||f.call(e,"blur",function(e){i(e.target)}),!0}return!1},m.handleProperty=function(e,s){r(e,s)?e[s]===!0&&(e[s]=this[s]):e[s]=!1},m.handleStyle=function(r,s){if(e(r[s]))try{r[s]=JSON.parse(r[s].replace(/'/g,'"'))}catch(e){console.error("error json format: "+r[s])}},m.recordStyle=function(e,r){if(r){e._sm.style||(e._sm.style={});var s=e._sm.style;for(var t in r)s[t]||(s[t]=e.style[t])}},m.handleHtml=function(r,s,t){if(t){r._sm[s]=[],e(t)&&(t=[t]);for(var n=0;n<t.length;n++){var l,a=t[n],i={};if(0===a.indexOf("!")&&(a=a.substring(1),i.quiet=!0),a.indexOf("<")>-1){for(var f=r;0===a.indexOf("+");)a=a.substring(1),f=f.parentNode;var o=u.createElement("div");o.innerHTML=a,l=o.children[0],f.parentNode.insertBefore(l,f.nextElementSibling)}else l=u.querySelector(a);l&&(i.dom=l,l.style.display="none",r._sm[s].push(i))}}},m.handleCss=function(r,s,t){if(t){e(t)&&(t=[t]),r._sm[s]=[];for(var n=t.length-1;n>=0;n--){for(var l=t[n],a=r;0===l.indexOf("+");)l=l.substring(1),a=a.parentNode;r._sm[s].push({target:a,className:l})}}},m.parseRule=function(e,r){var s=e.name,t=this.rules[s]||g.rules[s];t&&(t instanceof Array?r.rules.push({rule:t[0],message:t[1]}):r.rules.push({rule:t,params:e.params}))},m.parseStringFunction=function(e){var r={name:e},s=e.indexOf("(");return s>0&&(r.name=e.substring(0,s),r.params=e.substring(s+1,e.length-1).split(",")),r},m.parseString=function(e){var r={rules:[]},s=e.indexOf("&")>-1?"&":"|",t=e.split(s);r.token=s;for(var n=t.length-1;n>=0;n--){var l=t[n];if(l)if(0===l.indexOf("/")){var a=l.substring(1).split("/");2===a.length?r.rules.push({rule:new RegExp(a[0]),message:a[1]}):3===a.length&&r.rules.push({rule:new RegExp(a[0],"i"),message:a[2]})}else{var i=this.parseStringFunction(l),u=i.name,f=!0;"!"===u.charAt(0)&&(u=u.substring(1),f=!1),c.indexOf(u)>-1?"failStyle"===u||"passStyle"===u?r[u]=i.params[0]:r[u]=i.params||f:this.parseRule(i,r)}}return r},m.parseField=function(r){if(r instanceof Array)return{rules:[{rule:r[0],message:r[1]}]};if(r instanceof Function)return{rules:[{rule:r}]};if(e(r))return this.parseString(r);if("object"==typeof r){if(r.token="|",r.rule instanceof Array)r.rules=[{rule:r.rule[0],message:r.rule[1]}];else if(r.rule instanceof Function)r.rules=[{rule:r.rule}];else if(e(r.rule)){var s=r.rule;delete r.rule,s.indexOf("&")>-1&&(r.token="&");var t=s.split(r.token);r.rules=[];for(var n=t.length-1;n>=0;n--)t[n]&&this.parseRule(this.parseStringFunction(t[n]),r)}return r}};var v,h,g={server:"not been validated by server",required:"this is required",rules:{}};return s.config=function(e){for(var t=c.length-1;t>=0;t--){var n=c[t];r(e,n)&&(g[n]=e[n])}if(e.rules)for(var l in e.rules)g.rules[l]=e.rules[l];v=new s},s.validate=function(r,s){var t=e(r)?v.queryInput(r):r,n=0,l=0,a=!1;s&&(h=s.locate,a=s.short);for(var u=t.length-1;u>=0;u--){var f=t[u];if(f._sm)if(l++,i(f,s)===!0)n++;else if(a)return!1}return l===n},s.reset=function(r){for(var s=e(r)?v.queryInput(r):r,t=s.length-1;t>=0;t--)a(s[t])},s});