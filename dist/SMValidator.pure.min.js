/*!
 * sm-validator 0.14.1
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 * Released under the MIT License.
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e){return"string"==typeof e}function r(e,r){return o.call(e,r)}function s(e,s){var t=this;s||(s={});for(var l=p.length-1;l>=0;l--){var n=p[l];t[n]=r(s,n)?s[n]:g[n]}if(t.fields={},t.rules=s.rules||{},e){t.submit=s.submit;for(var a in s.fields)t.fields[a]=t.parseField(s.fields[a]);t.queryInput(e)}}function t(e,r){if(e)for(var s=e.length-1;s>=0;s--){for(var t=e[s],l=t.target,n=t.className.split(" "),a=l.className.split(" "),i=n.length-1;i>=0;i--){var u=n[i],f=a.indexOf(u);!r&&f>-1?a.splice(f,1):r&&f===-1&&a.push(u)}l.className=a.join(" ")}}function l(e,r,s){if(e)for(var t=e.length-1;t>=0;t--){var l=e[t];l.dom.style.display=r?"":"none",s&&!l.quiet&&(l.dom.innerHTML=s)}}function n(e,r){if(r)for(var s in r)e.style[s]=r[s]}function a(e,r){var s=e.type,a=e.name,i=e._sm,u=i.rule,f=!0,o=[],p=1,c="",d="|"===u.token;if("checkbox"!==s&&"radio"!==s||!e.form)if("select-multiple"===s)for(var v=e.children,g=v.length-1;g>=0;g--)v[g].selected&&v[g].value&&(c+=" ");else c=e.value;else for(var v=e.form.elements[a],g=v.length-1;g>=0;g--)v[g].checked&&(c+=" ");if(r&&"number"==typeof r.forceFlag)p=r.forceFlag,u.server&&(i.serverFlag=p,r.serverMessage&&(i.serverMessage=r.serverMessage),2===p&&(f=i.serverMessage||"no serverMessage!"));else if(u.server)u.required&&!c?(p=2,f=u.required):"number"==typeof i.serverFlag?(p=i.serverFlag,2===p&&(f=i.serverMessage||"no serverMessage!")):c?(p=2,f=u.server):p=0;else if(c)for(var g=u.rules.length-1;g>=0;g--){var h=u.rules[g],y=h.rule;if(y instanceof RegExp){if(!y.test(c)){if(f=h.message,p=2,d)break;o.push(f)}}else if(f=h.params?y.apply(null,[c].concat(h.params)):y.call(null,c),f!==!0){if(p=2,d)break;o.push(f)}}else u.required?(p=2,f=u.required):p=0;return p===i.flag&&i.lastResult===f&&d||(n(e,i.style),l(i.failHtml,!1),l(i.passHtml,!1),d?(i.lastResult=f,i.flag=p):p=o.length?2:1,1===p?(t(i.failCss,!1),t(i.passCss,!0),n(e,u.passStyle),l(i.passHtml,!0),u.pass&&u.pass.call(e)):2===p?(t(i.passCss,!1),t(i.failCss,!0),n(e,u.failStyle),l(i.failHtml,!0,d?f:o.join("<br/>")),u.fail&&u.fail.call(e,d?f:o)):(t(i.failCss,!1),t(i.passCss,!1))),2===p&&m&&(e.scrollIntoView(),m=!1),f}var i=window.document,u=i.addEventListener?i.addEventListener:i.attachEvent,f="oninput"in i?"input":"propertychange";u.call(i,f,function(e){var r=e.target;!r._sm||r._sm.rule.disinput||r._sm.rule.manul||a(r)}),u.call(i,"change",function(e){var r=e.target;"checkbox"!==r.type&&"radio"!==r.type||a(r)});var o=Object.prototype.hasOwnProperty,p=["required","server","short","disinput","disfocus","disblur","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],c=p.slice(3),d=s.prototype;d.queryInput=function(e){for(var r=this,t=[],l=i.querySelectorAll(e),n=l.length-1;n>=0;n--){var a=l[n],f=a.tagName;if("FORM"===f){a.novalidate="novalidate";for(var o=[],p=a.length-1;p>=0;p--)r.bindInput(a[p])&&o.push(a[p]);t=t.concat(o),r.submit&&o.length&&(a._smInputs=o,u.call(a,"submit",function(e){e.preventDefault();var t=s.validate(e.target._smInputs,{locate:!0,short:r.short});r.submit(t,e.target)}))}else"INPUT"!==f&&"SELECT"!==f&&"TEXTAREA"!==f||r.bindInput(a)&&t.push(a)}return t},d.bindInput=function(e){if(e._sm)return!0;var s=this,t=e.getAttribute("name"),l=e.getAttribute("data-rule"),n=l?this.parseString(l):this.fields[t];if(n){if(e._sm={rule:n,flag:0},!n._isInit){n._isInit=!0,s.handleProperty(n,"required"),s.handleProperty(n,"server"),n.server&&(n.manul=!0);for(var f=c.length-1;f>=0;f--){var o=c[f];r(n,o)||(n[o]=this[o])}s.handleStyle(n,"failStyle"),s.handleStyle(n,"passStyle")}if("checkbox"===e.type||"radio"===e.type){for(var p=i.querySelectorAll('input[name="'+t+'"]'),f=p.length-1;f>=0;f--)p[f]!==e&&(p[f]._sm=e._sm);n.disblur=n.disfocus=n.disinput=!0}return s.recordStyle(e,n.failStyle),s.recordStyle(e,n.passStyle),s.handleHtml(e,"failHtml",n.failHtml),s.handleHtml(e,"passHtml",n.passHtml),s.handleCss(e,"failCss",n.failCss),s.handleCss(e,"passCss",n.passCss),n.disfocus||u.call(e,"focus",function(e){a(e.target,{forceFlag:0})}),n.disblur||u.call(e,"blur",function(e){a(e.target)}),!0}return!1},d.handleProperty=function(e,s){r(e,s)?e[s]===!0&&(e[s]=this[s]):e[s]=!1},d.handleStyle=function(r,s){if(e(r[s]))try{r[s]=JSON.parse(r[s].replace(/'/g,'"'))}catch(e){console.error("error json format: "+r[s])}},d.recordStyle=function(e,r){if(r){e._sm.style||(e._sm.style={});var s=e._sm.style;for(var t in r)s[t]||(s[t]=e.style[t])}},d.handleHtml=function(r,s,t){if(t){r._sm[s]=[],e(t)&&(t=[t]);for(var l=0;l<t.length;l++){var n,a=t[l],u={};if(0===a.indexOf("!")&&(a=a.substring(1),u.quiet=!0),a.indexOf("<")>-1){for(var f=r;0===a.indexOf("+");)a=a.substring(1),f=f.parentNode;var o=i.createElement("div");o.innerHTML=a,n=o.children[0],f.parentNode.insertBefore(n,f.nextElementSibling)}else n=i.querySelector(a);n&&(u.dom=n,n.style.display="none",r._sm[s].push(u))}}},d.handleCss=function(r,s,t){if(t){e(t)&&(t=[t]),r._sm[s]=[];for(var l=t.length-1;l>=0;l--){for(var n=t[l],a=r;0===n.indexOf("+");)n=n.substring(1),a=a.parentNode;r._sm[s].push({target:a,className:n})}}},d.parseRule=function(e,r){var s=e.name,t=this.rules[s]||g.rules[s];t&&(t instanceof Array?r.rules.push({rule:t[0],message:t[1]}):r.rules.push({rule:t,params:e.params}))},d.parseStringFunction=function(e){var r={name:e},s=e.indexOf("(");return s>0&&(r.name=e.substring(0,s),r.params=e.substring(s+1,e.length-1).split(",")),r},d.parseString=function(e){var r={rules:[]},s=e.indexOf("&")>-1?"&":"|",t=e.split(s);r.token=s;for(var l=t.length-1;l>=0;l--){var n=t[l];if(n)if(0===n.indexOf("/")){var a=n.substring(1).split("/");2===a.length?r.rules.push({rule:new RegExp(a[0]),message:a[1]}):3===a.length&&r.rules.push({rule:new RegExp(a[0],"i"),message:a[2]})}else{var i=this.parseStringFunction(n);if(p.indexOf(i.name)>-1){var u=i.name;"failStyle"===u||"passStyle"===u?r[u]=i.params[0]:r[u]=i.params||!0}else this.parseRule(i,r)}}return r},d.parseField=function(r){if(r instanceof Array)return{rules:[{rule:r[0],message:r[1]}]};if(r instanceof Function)return{rules:[{rule:r}]};if(e(r))return this.parseString(r);if("object"==typeof r){if(r.rule instanceof Array)r.rules=[{rule:r.rule[0],message:r.rule[1]}];else if(r.rule instanceof Function)r.rules=[{rule:r.rule}];else if(e(r.rule)){var s=r.rule.split(";");r.rules=[];for(var t=s.length-1;t>=0;t--)s[t]&&this.parseRule(this.parseStringFunction(s[t]),r);delete r.rule}return r}};var v,m,g={server:"not been validated by server",required:"this is required",rules:{}};return s.config=function(e){for(var t=p.length-1;t>=0;t--){var l=p[t];r(e,l)&&(g[l]=e[l])}if(e.rules)for(var n in e.rules)g.rules[n]=e.rules[n];v=new s},s.validate=function(r,s){var t=e(r)?v.queryInput(r):r,l=0,n=0,i=!1;s&&(m=s.locate,i=s.short);for(var u=t.length-1;u>=0;u--){var f=t[u];if(f._sm)if(n++,a(f,s)===!0)l++;else if(i)return!1}return n===l},s.reset=function(e){s.validate(e,{forceFlag:0})},s});